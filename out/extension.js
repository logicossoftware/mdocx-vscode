"use strict";var co=Object.create;var kt=Object.defineProperty;var uo=Object.getOwnPropertyDescriptor;var fo=Object.getOwnPropertyNames;var ho=Object.getPrototypeOf,po=Object.prototype.hasOwnProperty;var ur=(t,e)=>()=>(t&&(e=t(t=0)),e);var fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),cn=(t,e)=>{for(var r in e)kt(t,r,{get:e[r],enumerable:!0})},un=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of fo(e))!po.call(t,i)&&i!==r&&kt(t,i,{get:()=>e[i],enumerable:!(n=uo(e,i))||n.enumerable});return t};var We=(t,e,r)=>(r=t!=null?co(ho(t)):{},un(e||!t||!t.__esModule?kt(r,"default",{value:t,enumerable:!0}):r,t)),mo=t=>un(kt({},"__esModule",{value:!0}),t);function ua(t,e){return ca(t,e||{},0,0)}function fa(t,e){return ia(t,{i:2},e&&e.out,e&&e.dictionary)}function Cn(t,e){if(e){for(var r=new O(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(_n)return _n.encode(t);for(var i=t.length,a=new O(t.length+(t.length>>1)),o=0,s=function(c){a[o++]=c},n=0;n<i;++n){if(o+5>a.length){var l=new O(o+8+(i-n<<1));l.set(a),a=l}var u=t.charCodeAt(n);u<128||e?s(u):u<2048?(s(192|u>>6),s(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++n)&1023,s(240|u>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|u&63)):(s(224|u>>12),s(128|u>>6&63),s(128|u&63))}return ft(a,0,o)}function pa(t,e){if(e){for(var r="",n=0;n<t.length;n+=16384)r+=String.fromCharCode.apply(null,t.subarray(n,n+16384));return r}else{if(Ir)return Ir.decode(t);var i=ha(t),a=i.s,r=i.r;return r.length&&Y(8),a}}function Nn(t,e){e||(e={});var r={},n=[];On(t,"",r,e);var i=0,a=0;for(var o in r){var s=r[o],l=s[0],u=s[1],c=u.level==0?0:8,f=Cn(o),d=f.length,h=u.comment,p=h&&Cn(h),m=p&&p.length,v=Sr(u.extra);d>65535&&Y(11);var E=c?ua(l,u):l,y=E.length,b=la();b.p(l),n.push(Pn(u,{size:l.length,crc:b.d(),c:E,f,m:p,u:d!=o.length||p&&h.length!=m,o:i,compression:c})),i+=30+d+v+y,a+=76+2*(d+v)+(m||0)+y}for(var S=new O(a+22),T=i,w=a-i,I=0;I<n.length;++I){var f=n[I];Bn(S,f.o,f,f.f,f.u,f.c.length);var M=30+f.f.length+Sr(f.extra);S.set(f.c,f.o+M),Bn(S,i,f,f.f,f.u,f.c.length,f.o,f.m),i+=16+M+(f.m?f.m.length:0)}return ya(S,i,n.length,w,T),S}function Zn(t,e){for(var r={},n=t.length-22;he(t,n)!=101010256;--n)(!n||t.length-n>65558)&&Y(13);var i=pe(t,n+8);if(!i)return{};var a=he(t,n+16),o=a==4294967295||i==65535;if(o){var s=he(t,n-12);o=he(t,s)==101075792,o&&(i=he(t,s+32),a=he(t,s+48))}for(var l=e&&e.filter,u=0;u<i;++u){var c=ga(t,a,o),f=c[0],d=c[1],h=c[2],p=c[3],m=c[4],v=c[5],E=ma(t,v);a=m,(!l||l({name:p,size:d,originalSize:h,compression:f}))&&(f?f==8?r[p]=fa(t.subarray(E,E+d),{out:new O(h)}):Y(14,"unknown compression type "+f):r[p]=ft(t,E,E+d))}return r}var Un,Qo,Ko,O,oe,_r,It,St,Mr,Dn,zn,Ln,Er,$n,Jo,An,Tr,Te,D,me,Ue,D,D,D,D,ut,D,Yo,ea,ta,ra,wr,de,br,Cr,ft,na,Y,ia,Ae,lt,xr,Ar,In,ct,Rn,Sn,oa,Fn,aa,sa,la,ca,Pn,pe,he,kr,X,On,_n,Ir,da,ha,ma,ga,va,Sr,Bn,ya,Gn=ur(()=>{Un=require("module"),Qo=(0,Un.createRequire)("/");try{Ko=Qo("worker_threads").Worker}catch{}O=Uint8Array,oe=Uint16Array,_r=Int32Array,It=new O([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),St=new O([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mr=new O([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dn=function(t,e){for(var r=new oe(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new _r(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return{b:r,r:i}},zn=Dn(It,2),Ln=zn.b,Er=zn.r;Ln[28]=258,Er[258]=28;$n=Dn(St,0),Jo=$n.b,An=$n.r,Tr=new oe(32768);for(D=0;D<32768;++D)Te=(D&43690)>>1|(D&21845)<<1,Te=(Te&52428)>>2|(Te&13107)<<2,Te=(Te&61680)>>4|(Te&3855)<<4,Tr[D]=((Te&65280)>>8|(Te&255)<<8)>>1;me=function(t,e,r){for(var n=t.length,i=0,a=new oe(e);i<n;++i)t[i]&&++a[t[i]-1];var o=new oe(e);for(i=1;i<e;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(r){s=new oe(1<<e);var l=15-e;for(i=0;i<n;++i)if(t[i])for(var u=i<<4|t[i],c=e-t[i],f=o[t[i]-1]++<<c,d=f|(1<<c)-1;f<=d;++f)s[Tr[f]>>l]=u}else for(s=new oe(n),i=0;i<n;++i)t[i]&&(s[i]=Tr[o[t[i]-1]++]>>15-t[i]);return s},Ue=new O(288);for(D=0;D<144;++D)Ue[D]=8;for(D=144;D<256;++D)Ue[D]=9;for(D=256;D<280;++D)Ue[D]=7;for(D=280;D<288;++D)Ue[D]=8;ut=new O(32);for(D=0;D<32;++D)ut[D]=5;Yo=me(Ue,9,0),ea=me(Ue,9,1),ta=me(ut,5,0),ra=me(ut,5,1),wr=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},de=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},br=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Cr=function(t){return(t+7)/8|0},ft=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new O(t.subarray(e,r))},na=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Y=function(t,e,r){var n=new Error(e||na[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Y),!r)throw n;return n},ia=function(t,e,r,n){var i=t.length,a=n?n.length:0;if(!i||e.f&&!e.l)return r||new O(0);var o=!r,s=o||e.i!=2,l=e.i;o&&(r=new O(i*3));var u=function(ce){var ue=r.length;if(ce>ue){var Be=new O(Math.max(ue*2,ce));Be.set(r),r=Be}},c=e.f||0,f=e.p||0,d=e.b||0,h=e.l,p=e.d,m=e.m,v=e.n,E=i*8;do{if(!h){c=de(t,f,1);var y=de(t,f+1,3);if(f+=3,y)if(y==1)h=ea,p=ra,m=9,v=5;else if(y==2){var w=de(t,f,31)+257,I=de(t,f+10,15)+4,M=w+de(t,f+5,31)+1;f+=14;for(var x=new O(M),_=new O(19),z=0;z<I;++z)_[Mr[z]]=de(t,f+z*3,7);f+=I*3;for(var R=wr(_),G=(1<<R)-1,A=me(_,R,1),z=0;z<M;){var k=A[de(t,f,G)];f+=k&15;var b=k>>4;if(b<16)x[z++]=b;else{var C=0,F=0;for(b==16?(F=3+de(t,f,3),f+=2,C=x[z-1]):b==17?(F=3+de(t,f,7),f+=3):b==18&&(F=11+de(t,f,127),f+=7);F--;)x[z++]=C}}var j=x.subarray(0,w),N=x.subarray(w);m=wr(j),v=wr(N),h=me(j,m,1),p=me(N,v,1)}else Y(1);else{var b=Cr(f)+4,S=t[b-4]|t[b-3]<<8,T=b+S;if(T>i){l&&Y(0);break}s&&u(d+S),r.set(t.subarray(b,T),d),e.b=d+=S,e.p=f=T*8,e.f=c;continue}if(f>E){l&&Y(0);break}}s&&u(d+131072);for(var be=(1<<m)-1,J=(1<<v)-1,re=f;;re=f){var C=h[br(t,f)&be],Q=C>>4;if(f+=C&15,f>E){l&&Y(0);break}if(C||Y(2),Q<256)r[d++]=Q;else if(Q==256){re=f,h=null;break}else{var K=Q-254;if(Q>264){var z=Q-257,P=It[z];K=de(t,f,(1<<P)-1)+Ln[z],f+=P}var ne=p[br(t,f)&J],ee=ne>>4;ne||Y(3),f+=ne&15;var N=Jo[ee];if(ee>3){var P=St[ee];N+=br(t,f)&(1<<P)-1,f+=P}if(f>E){l&&Y(0);break}s&&u(d+131072);var se=d+K;if(d<N){var xe=a-N,ke=Math.min(N,se);for(xe+d<0&&Y(3);d<ke;++d)r[d]=n[xe+d]}for(;d<se;++d)r[d]=r[d-N]}}e.l=h,e.p=re,e.b=d,e.f=c,h&&(c=1,e.m=m,e.d=p,e.n=v)}while(!c);return d!=r.length&&o?ft(r,0,d):r.subarray(0,d)},Ae=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},lt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},xr=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,a=r.slice();if(!i)return{t:Fn,l:0};if(i==1){var o=new O(r[0].s+1);return o[r[0].s]=1,{t:o,l:1}}r.sort(function(T,w){return T.f-w.f}),r.push({s:-1,f:25001});var s=r[0],l=r[1],u=0,c=1,f=2;for(r[0]={s:-1,f:s.f+l.f,l:s,r:l};c!=i-1;)s=r[r[u].f<r[f].f?u++:f++],l=r[u!=c&&r[u].f<r[f].f?u++:f++],r[c++]={s:-1,f:s.f+l.f,l:s,r:l};for(var d=a[0].s,n=1;n<i;++n)a[n].s>d&&(d=a[n].s);var h=new oe(d+1),p=Ar(r[c-1],h,0);if(p>e){var n=0,m=0,v=p-e,E=1<<v;for(a.sort(function(w,I){return h[I.s]-h[w.s]||w.f-I.f});n<i;++n){var y=a[n].s;if(h[y]>e)m+=E-(1<<p-h[y]),h[y]=e;else break}for(m>>=v;m>0;){var b=a[n].s;h[b]<e?m-=1<<e-h[b]++-1:++n}for(;n>=0&&m;--n){var S=a[n].s;h[S]==e&&(--h[S],++m)}p=e}return{t:new O(h),l:p}},Ar=function(t,e,r){return t.s==-1?Math.max(Ar(t.l,e,r+1),Ar(t.r,e,r+1)):e[t.s]=r},In=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new oe(++e),n=0,i=t[0],a=1,o=function(l){r[n++]=l},s=1;s<=e;++s)if(t[s]==i&&s!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=t[s]}return{c:r.subarray(0,n),n:e}},ct=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Rn=function(t,e,r){var n=r.length,i=Cr(e+2);t[i]=n&255,t[i+1]=n>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var a=0;a<n;++a)t[i+a+4]=r[a];return(i+4+n)*8},Sn=function(t,e,r,n,i,a,o,s,l,u,c){Ae(e,c++,r),++i[256];for(var f=xr(i,15),d=f.t,h=f.l,p=xr(a,15),m=p.t,v=p.l,E=In(d),y=E.c,b=E.n,S=In(m),T=S.c,w=S.n,I=new oe(19),M=0;M<y.length;++M)++I[y[M]&31];for(var M=0;M<T.length;++M)++I[T[M]&31];for(var x=xr(I,7),_=x.t,z=x.l,R=19;R>4&&!_[Mr[R-1]];--R);var G=u+5<<3,A=ct(i,Ue)+ct(a,ut)+o,k=ct(i,d)+ct(a,m)+o+14+3*R+ct(I,_)+2*I[16]+3*I[17]+7*I[18];if(l>=0&&G<=A&&G<=k)return Rn(e,c,t.subarray(l,l+u));var C,F,j,N;if(Ae(e,c,1+(k<A)),c+=2,k<A){C=me(d,h,0),F=d,j=me(m,v,0),N=m;var be=me(_,z,0);Ae(e,c,b-257),Ae(e,c+5,w-1),Ae(e,c+10,R-4),c+=14;for(var M=0;M<R;++M)Ae(e,c+3*M,_[Mr[M]]);c+=3*R;for(var J=[y,T],re=0;re<2;++re)for(var Q=J[re],M=0;M<Q.length;++M){var K=Q[M]&31;Ae(e,c,be[K]),c+=_[K],K>15&&(Ae(e,c,Q[M]>>5&127),c+=Q[M]>>12)}}else C=Yo,F=Ue,j=ta,N=ut;for(var M=0;M<s;++M){var P=n[M];if(P>255){var K=P>>18&31;lt(e,c,C[K+257]),c+=F[K+257],K>7&&(Ae(e,c,P>>23&31),c+=It[K]);var ne=P&31;lt(e,c,j[ne]),c+=N[ne],ne>3&&(lt(e,c,P>>5&8191),c+=St[ne])}else lt(e,c,C[P]),c+=F[P]}return lt(e,c,C[256]),c+F[256]},oa=new _r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fn=new O(0),aa=function(t,e,r,n,i,a){var o=a.z||t.length,s=new O(n+o+5*(1+Math.ceil(o/7e3))+i),l=s.subarray(n,s.length-i),u=a.l,c=(a.r||0)&7;if(e){c&&(l[0]=a.r>>3);for(var f=oa[e-1],d=f>>13,h=f&8191,p=(1<<r)-1,m=a.p||new oe(32768),v=a.h||new oe(p+1),E=Math.ceil(r/3),y=2*E,b=function(cr){return(t[cr]^t[cr+1]<<E^t[cr+2]<<y)&p},S=new _r(25e3),T=new oe(288),w=new oe(32),I=0,M=0,x=a.i||0,_=0,z=a.w||0,R=0;x+2<o;++x){var G=b(x),A=x&32767,k=v[G];if(m[A]=k,v[G]=A,z<=x){var C=o-x;if((I>7e3||_>24576)&&(C>423||!u)){c=Sn(t,l,0,S,T,w,M,_,R,x-R,c),_=I=M=0,R=x;for(var F=0;F<286;++F)T[F]=0;for(var F=0;F<30;++F)w[F]=0}var j=2,N=0,be=h,J=A-k&32767;if(C>2&&G==b(x-J))for(var re=Math.min(d,C)-1,Q=Math.min(32767,x),K=Math.min(258,C);J<=Q&&--be&&A!=k;){if(t[x+j]==t[x+j-J]){for(var P=0;P<K&&t[x+P]==t[x+P-J];++P);if(P>j){if(j=P,N=J,P>re)break;for(var ne=Math.min(J,P-2),ee=0,F=0;F<ne;++F){var se=x-J+F&32767,xe=m[se],ke=se-xe&32767;ke>ee&&(ee=ke,k=se)}}}A=k,k=m[A],J+=A-k&32767}if(N){S[_++]=268435456|Er[j]<<18|An[N];var ce=Er[j]&31,ue=An[N]&31;M+=It[ce]+St[ue],++T[257+ce],++w[ue],z=x+j,++I}else S[_++]=t[x],++T[t[x]]}}for(x=Math.max(x,z);x<o;++x)S[_++]=t[x],++T[t[x]];c=Sn(t,l,u,S,T,w,M,_,R,x-R,c),u||(a.r=c&7|l[c/8|0]<<3,c-=7,a.h=v,a.p=m,a.i=x,a.w=z)}else{for(var x=a.w||0;x<o+u;x+=65535){var Be=x+65535;Be>=o&&(l[c/8|0]=u,Be=o),c=Rn(l,c+1,t.subarray(x,Be))}a.i=o}return ft(s,0,n+Cr(c)+i)},sa=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),la=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=sa[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},ca=function(t,e,r,n,i){if(!i&&(i={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new O(a.length+t.length);o.set(a),o.set(t,a.length),t=o,i.w=a.length}return aa(t,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,i)},Pn=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},pe=function(t,e){return t[e]|t[e+1]<<8},he=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},kr=function(t,e){return he(t,e)+he(t,e+4)*4294967296},X=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};On=function(t,e,r,n){for(var i in t){var a=t[i],o=e+i,s=n;Array.isArray(a)&&(s=Pn(n,a[1]),a=a[0]),a instanceof O?r[o]=[a,s]:(r[o+="/"]=[new O(0),s],On(a,o,r,n))}},_n=typeof TextEncoder<"u"&&new TextEncoder,Ir=typeof TextDecoder<"u"&&new TextDecoder,da=0;try{Ir.decode(Fn,{stream:!0}),da=1}catch{}ha=function(t){for(var e="",r=0;;){var n=t[r++],i=(n>127)+(n>223)+(n>239);if(r+i>t.length)return{s:e,r:ft(t,r-1)};i?i==3?(n=((n&15)<<18|(t[r++]&63)<<12|(t[r++]&63)<<6|t[r++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|t[r++]&63):e+=String.fromCharCode((n&15)<<12|(t[r++]&63)<<6|t[r++]&63):e+=String.fromCharCode(n)}};ma=function(t,e){return e+30+pe(t,e+26)+pe(t,e+28)},ga=function(t,e,r){var n=pe(t,e+28),i=pa(t.subarray(e+46,e+46+n),!(pe(t,e+8)&2048)),a=e+46+n,o=he(t,e+20),s=r&&o==4294967295?va(t,a):[o,he(t,e+24),he(t,e+42)],l=s[0],u=s[1],c=s[2];return[pe(t,e+10),l,u,i,a+pe(t,e+30)+pe(t,e+32),c]},va=function(t,e){for(;pe(t,e)!=1;e+=4+pe(t,e+2));return[kr(t,e+12),kr(t,e+4),kr(t,e+20)]},Sr=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&Y(9),e+=n+4}return e},Bn=function(t,e,r,n,i,a,o,s){var l=n.length,u=r.extra,c=s&&s.length,f=Sr(u);X(t,e,o!=null?33639248:67324752),e+=4,o!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=i&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var d=new Date(r.mtime==null?Date.now():r.mtime),h=d.getFullYear()-1980;if((h<0||h>119)&&Y(10),X(t,e,h<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>1),e+=4,a!=-1&&(X(t,e,r.crc),X(t,e+4,a<0?-a-2:a),X(t,e+8,r.size)),X(t,e+12,l),X(t,e+14,f),e+=16,o!=null&&(X(t,e,c),X(t,e+6,r.attrs),X(t,e+10,o),e+=14),t.set(n,e),e+=l,f)for(var p in u){var m=u[p],v=m.length;X(t,e,+p),X(t,e+2,v),t.set(m,e+4),e+=4+v}return c&&(t.set(s,e),e+=c),e},ya=function(t,e,r,n,i){X(t,e,101010256),X(t,e+8,r),X(t,e+10,r),X(t,e+12,n),X(t,e+16,i)}});function qn(t,e){for(var r=[],n=+!e,i=0,a=0;t.length;){var o=Ea(t,n||e);if(typeof o=="object"){for(n?(e=null,o.w.length==o.u&&(r.push(e=o.w),a+=o.u)):(r.push(e),o.e=0);!o.l;){var s=Ua(t,o,e);s||H(5),e?o.e=o.y:(r.push(s),a+=s.length,xa(o.w,0,s.length),o.w.set(s,o.w.length-s.length))}i=o.b+o.c*4}else i=o;t=t.subarray(i)}return Da(r,a)}var wa,Z,_t,ba,Ct,Br,ht,xa,ka,H,Hn,Ma,Ea,Ne,pt,Ta,Aa,Ia,Sa,jn,Ur,_a,Dr,Ca,dt,Ba,Ua,Da,Wn=ur(()=>{wa=ArrayBuffer,Z=Uint8Array,_t=Uint16Array,ba=Int16Array,Ct=Int32Array,Br=function(t,e,r){if(Z.prototype.slice)return Z.prototype.slice.call(t,e,r);(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new Z(r-e);return n.set(t.subarray(e,r)),n},ht=function(t,e,r,n){if(Z.prototype.fill)return Z.prototype.fill.call(t,e,r,n);for((r==null||r<0)&&(r=0),(n==null||n>t.length)&&(n=t.length);r<n;++r)t[r]=e;return t},xa=function(t,e,r,n){if(Z.prototype.copyWithin)return Z.prototype.copyWithin.call(t,e,r,n);for((r==null||r<0)&&(r=0),(n==null||n>t.length)&&(n=t.length);r<n;)t[e++]=t[r++]},ka=["invalid zstd data","window size too large (>2046MB)","invalid block type","FSE accuracy too high","match distance too far back","unexpected EOF"],H=function(t,e,r){var n=new Error(e||ka[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,H),!r)throw n;return n},Hn=function(t,e,r){for(var n=0,i=0;n<r;++n)i|=t[e++]<<(n<<3);return i},Ma=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Ea=function(t,e){var r=t[0]|t[1]<<8|t[2]<<16;if(r==3126568&&t[3]==253){var n=t[4],i=n>>5&1,a=n>>2&1,o=n&3,s=n>>6;n&8&&H(0);var l=6-i,u=o==3?4:o,c=Hn(t,l,u);l+=u;var f=s?1<<s:i,d=Hn(t,l,f)+(s==1&&256),h=d;if(!i){var p=1<<10+(t[5]>>3);h=p+(p>>3)*(t[5]&7)}h>2145386496&&H(1);var m=new Z((e==1?d||h:e?0:h)+12);return m[0]=1,m[4]=4,m[8]=8,{b:l+f,y:0,l:0,d:c,w:e&&e!=1?e:m.subarray(12),e:h,o:new Ct(m.buffer,0,3),u:d,c:a,m:Math.min(131072,h)}}else if((r>>4|t[3]<<20)==25481893)return Ma(t,4)+8;H(0)},Ne=function(t){for(var e=0;1<<e<=t;++e);return e-1},pt=function(t,e,r){var n=(e<<3)+4,i=(t[e]&15)+5;i>r&&H(3);for(var a=1<<i,o=a,s=-1,l=-1,u=-1,c=a,f=new wa(512+(a<<2)),d=new ba(f,0,256),h=new _t(f,0,256),p=new _t(f,512,a),m=512+(a<<1),v=new Z(f,m,a),E=new Z(f,m+a);s<255&&o>0;){var y=Ne(o+1),b=n>>3,S=(1<<y+1)-1,T=(t[b]|t[b+1]<<8|t[b+2]<<16)>>(n&7)&S,w=(1<<y)-1,I=S-o-1,M=T&w;if(M<I?(n+=y,T=M):(n+=y+1,T>w&&(T-=I)),d[++s]=--T,T==-1?(o+=T,v[--c]=s):o-=T,!T)do{var x=n>>3;l=(t[x]|t[x+1]<<8)>>(n&7)&3,n+=2,s+=l}while(l==3)}(s>255||o)&&H(0);for(var _=0,z=(a>>1)+(a>>3)+3,R=a-1,G=0;G<=s;++G){var A=d[G];if(A<1){h[G]=-A;continue}for(u=0;u<A;++u){v[_]=G;do _=_+z&R;while(_>=c)}}for(_&&H(0),u=0;u<a;++u){var k=h[v[u]]++,C=E[u]=i-Ne(k);p[u]=(k<<C)-a}return[n+7>>3,{b:i,s:v,n:E,t:p}]},Ta=function(t,e){var r=0,n=-1,i=new Z(292),a=t[e],o=i.subarray(0,256),s=i.subarray(256,268),l=new _t(i.buffer,268);if(a<128){var u=pt(t,e+1,6),c=u[0],f=u[1];e+=a;var d=c<<3,h=t[e];h||H(0);for(var p=0,m=0,v=f.b,E=v,y=(++e<<3)-8+Ne(h);y-=v,!(y<d);){var b=y>>3;if(p+=(t[b]|t[b+1]<<8)>>(y&7)&(1<<v)-1,o[++n]=f.s[p],y-=E,y<d)break;b=y>>3,m+=(t[b]|t[b+1]<<8)>>(y&7)&(1<<E)-1,o[++n]=f.s[m],v=f.n[p],p=f.t[p],E=f.n[m],m=f.t[m]}++n>255&&H(0)}else{for(n=a-127;r<n;r+=2){var S=t[++e];o[r]=S>>4,o[r+1]=S&15}++e}var T=0;for(r=0;r<n;++r){var w=o[r];w>11&&H(0),T+=w&&1<<w-1}var I=Ne(T)+1,M=1<<I,x=M-T;for(x&x-1&&H(0),o[n++]=Ne(x)+1,r=0;r<n;++r){var w=o[r];++s[o[r]=w&&I+1-w]}var _=new Z(M<<1),z=_.subarray(0,M),R=_.subarray(M);for(l[I]=0,r=I;r>0;--r){var G=l[r];ht(R,r,G,l[r-1]=G+s[r]*(1<<I-r))}for(l[0]!=M&&H(0),r=0;r<n;++r){var A=o[r];if(A){var k=l[A];ht(z,r,k,l[A]=k+(1<<I-A))}}return[e,{n:R,b:I,s:z}]},Aa=pt(new Z([81,16,99,140,49,198,24,99,12,33,196,24,99,102,102,134,70,146,4]),0,6)[1],Ia=pt(new Z([33,20,196,24,99,140,33,132,16,66,8,33,132,16,66,8,33,68,68,68,68,68,68,68,68,36,9]),0,6)[1],Sa=pt(new Z([32,132,16,66,102,70,68,68,68,68,36,73,2]),0,5)[1],jn=function(t,e){for(var r=t.length,n=new Ct(r),i=0;i<r;++i)n[i]=e,e+=1<<t[i];return n},Ur=new Z(new Ct([0,0,0,0,16843009,50528770,134678020,202050057,269422093]).buffer,0,36),_a=jn(Ur,0),Dr=new Z(new Ct([0,0,0,0,0,0,0,0,16843009,50528770,117769220,185207048,252579084,16]).buffer,0,53),Ca=jn(Dr,3),dt=function(t,e,r){var n=t.length,i=e.length,a=t[n-1],o=(1<<r.b)-1,s=-r.b;a||H(0);for(var l=0,u=r.b,c=(n<<3)-8+Ne(a)-u,f=-1;c>s&&f<i;){var d=c>>3,h=(t[d]|t[d+1]<<8|t[d+2]<<16)>>(c&7);l=(l<<u|h)&o,e[++f]=r.s[l],c-=u=r.n[l]}(c!=s||f+1!=i)&&H(0)},Ba=function(t,e,r){var n=6,i=e.length,a=i+3>>2,o=a<<1,s=a+o;dt(t.subarray(n,n+=t[0]|t[1]<<8),e.subarray(0,a),r),dt(t.subarray(n,n+=t[2]|t[3]<<8),e.subarray(a,o),r),dt(t.subarray(n,n+=t[4]|t[5]<<8),e.subarray(o,s),r),dt(t.subarray(n),e.subarray(s),r)},Ua=function(t,e,r){var n,i=e.b,a=t[i],o=a>>1&3;e.l=a&1;var s=a>>3|t[i+1]<<5|t[i+2]<<13,l=(i+=3)+s;if(o==1)return i>=t.length?void 0:(e.b=i+1,r?(ht(r,t[i],e.y,e.y+=s),r):ht(new Z(s),t[i]));if(!(l>t.length)){if(o==0)return e.b=l,r?(r.set(t.subarray(i,l),e.y),e.y+=s,r):Br(t,i,l);if(o==2){var u=t[i],c=u&3,f=u>>2&3,d=u>>4,h=0,p=0;c<2?f&1?d|=t[++i]<<4|(f&2&&t[++i]<<12):d=u>>3:(p=f,f<2?(d|=(t[++i]&63)<<4,h=t[i]>>6|t[++i]<<2):f==2?(d|=t[++i]<<4|(t[++i]&3)<<12,h=t[i]>>2|t[++i]<<6):(d|=t[++i]<<4|(t[++i]&63)<<12,h=t[i]>>6|t[++i]<<2|t[++i]<<10)),++i;var m=r?r.subarray(e.y,e.y+e.m):new Z(e.m),v=m.length-d;if(c==0)m.set(t.subarray(i,i+=d),v);else if(c==1)ht(m,t[i++],v);else{var E=e.h;if(c==2){var y=Ta(t,i);h+=i-(i=y[0]),e.h=E=y[1]}else E||H(0);(p?Ba:dt)(t.subarray(i,i+=h),m.subarray(v),E)}var b=t[i++];if(b){b==255?b=(t[i++]|t[i++]<<8)+32512:b>127&&(b=b-128<<8|t[i++]);var S=t[i++];S&3&&H(0);for(var T=[Ia,Sa,Aa],w=2;w>-1;--w){var I=S>>(w<<1)+2&3;if(I==1){var M=new Z([0,0,t[i++]]);T[w]={s:M.subarray(2,3),n:M.subarray(0,1),t:new _t(M.buffer,0,1),b:0}}else I==2?(n=pt(t,i,9-(w&1)),i=n[0],T[w]=n[1]):I==3&&(e.t||H(0),T[w]=e.t[w])}var x=e.t=T,_=x[0],z=x[1],R=x[2],G=t[l-1];G||H(0);var A=(l<<3)-8+Ne(G)-R.b,k=A>>3,C=0,F=(t[k]|t[k+1]<<8)>>(A&7)&(1<<R.b)-1;k=(A-=z.b)>>3;var j=(t[k]|t[k+1]<<8)>>(A&7)&(1<<z.b)-1;k=(A-=_.b)>>3;var N=(t[k]|t[k+1]<<8)>>(A&7)&(1<<_.b)-1;for(++b;--b;){var be=R.s[F],J=R.n[F],re=_.s[N],Q=_.n[N],K=z.s[j],P=z.n[j];k=(A-=K)>>3;var ne=1<<K,ee=ne+((t[k]|t[k+1]<<8|t[k+2]<<16|t[k+3]<<24)>>>(A&7)&ne-1);k=(A-=Dr[re])>>3;var se=Ca[re]+((t[k]|t[k+1]<<8|t[k+2]<<16)>>(A&7)&(1<<Dr[re])-1);k=(A-=Ur[be])>>3;var xe=_a[be]+((t[k]|t[k+1]<<8|t[k+2]<<16)>>(A&7)&(1<<Ur[be])-1);if(k=(A-=J)>>3,F=R.t[F]+((t[k]|t[k+1]<<8)>>(A&7)&(1<<J)-1),k=(A-=Q)>>3,N=_.t[N]+((t[k]|t[k+1]<<8)>>(A&7)&(1<<Q)-1),k=(A-=P)>>3,j=z.t[j]+((t[k]|t[k+1]<<8)>>(A&7)&(1<<P)-1),ee>3)e.o[2]=e.o[1],e.o[1]=e.o[0],e.o[0]=ee-=3;else{var ke=ee-(xe!=0);ke?(ee=ke==3?e.o[0]-1:e.o[ke],ke>1&&(e.o[2]=e.o[1]),e.o[1]=e.o[0],e.o[0]=ee):ee=e.o[0]}for(var w=0;w<xe;++w)m[C+w]=m[v+w];C+=xe,v+=xe;var ce=C-ee;if(ce<0){var ue=-ce,Be=e.e+ce;ue>se&&(ue=se);for(var w=0;w<ue;++w)m[C+w]=e.w[Be+w];C+=ue,se-=ue,ce=0}for(var w=0;w<se;++w)m[C+w]=m[ce+w];C+=se}if(C!=v)for(;v<m.length;)m[C++]=m[v++];else C=m.length;r?e.y+=C:m=Br(m,0,C)}else if(r){if(e.y+=d,v)for(var w=0;w<d;++w)m[w]=m[v+w]}else v&&(m=Br(m,v));return e.b=l,m}H(2)}},Da=function(t,e){if(t.length==1)return t[0];for(var r=new Z(e),n=0,i=0;n<t.length;++n){var a=t[n];r.set(a,i),i+=a.length}return r}});var ai=fe($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.Module=void 0;var g=typeof g<"u"?g:{};$t.Module=g;var gt={},De;for(De in g)g.hasOwnProperty(De)&&(gt[De]=g[De]);var za=[],Ke=g.printErr||console.warn.bind(console);for(De in gt)gt.hasOwnProperty(De)&&(g[De]=gt[De]);var zr=(t,e)=>{throw e};gt=null;g.arguments&&(za=g.arguments);g.thisProgram&&(thisProgram=g.thisProgram);g.quit&&(zr=g.quit);typeof WebAssembly!="object"&&Lr("no native wasm support detected");var Bt,zt=!1,Lt,Vn,La;function Xn(){var t=Bt.buffer;g.HEAP8=La=new Int8Array(t),g.HEAPU8=Vn=new Uint8Array(t)}var Qn=[],Kn=[],Jn=[],$a=!1;function Ra(){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Oa(g.preRun.shift());$r(Qn)}function Fa(){$a=!0,$r(Kn)}function Pa(){if(g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;)Za(g.postRun.shift());$r(Jn)}function Oa(t){Qn.unshift(t)}function Na(t){Kn.unshift(t)}function Za(t){Jn.unshift(t)}var Ze=0,vt=null;function Ga(t){var e;Ze++,(e=g.monitorRunDependencies)===null||e===void 0||e.call(g,Ze)}function Ha(t){var e;if(Ze--,(e=g.monitorRunDependencies)===null||e===void 0||e.call(g,Ze),Ze==0&&vt){var r=vt;vt=null,r()}}function Lr(t){var e;(e=g.onAbort)===null||e===void 0||e.call(g,t),t="Aborted("+t+")",Ke(t),zt=!0,t+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(t);throw r}function ja(){return{a:as}}function qa(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})}function Wa(t){var e=ja();function r(s,l){return q=s.exports,Bt=q.f,Xn(),Na(q.g),Ha("wasm-instantiate"),q}Ga("wasm-instantiate");function n(s){r(s.instance)}function i(s){return qa(t).then(function(l){var u=WebAssembly.instantiate(l,e);return u}).then(s,function(l){Ke("failed to asynchronously prepare wasm: "+l),Lr(l)})}function a(){return t&&t.byteLength>0?WebAssembly.instantiate(t,e).then(n,function(s){Ke("wasm compile failed: "+s)}):typeof WebAssembly.instantiateStreaming=="function"&&typeof t=="string"&&typeof fetch=="function"?fetch(t,{credentials:"same-origin"}).then(function(s){var l=WebAssembly.instantiateStreaming(s,e);return l.then(n,function(u){return Ke("wasm streaming compile failed: "+u),Ke("falling back to ArrayBuffer instantiation"),i(n)})}):i(n)}if(g.instantiateWasm)try{var o=g.instantiateWasm(e,r);return o}catch(s){return Ke("Module.instantiateWasm callback failed with error: "+s),!1}return a(),{}}var Ut=class{constructor(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}},$r=t=>{for(;t.length>0;)t.shift()(g)},Yn=g.noExitRuntime||!0,Va=()=>Lr(""),ei=0,Xa=()=>{Yn=!1,ei=0},mt={},ti=t=>{if(t instanceof Ut||t=="unwind")return Lt;zr(1,t)},ri=()=>Yn||ei>0,ni=t=>{var e;Lt=t,ri()||((e=g.onExit)===null||e===void 0||e.call(g,t),zt=!0),zr(t,new Ut(t))},Qa=(t,e)=>{Lt=t,ni(t)},Ka=Qa,Ja=()=>{if(!ri())try{Ka(Lt)}catch(t){ti(t)}},Ya=t=>{if(!zt)try{t(),Ja()}catch(e){ti(e)}},es=()=>performance.now(),ts=(t,e)=>{if(mt[t]&&(clearTimeout(mt[t].id),delete mt[t]),!e)return 0;var r=setTimeout(()=>{delete mt[t],Ya(()=>ii(t,es()))},e);return mt[t]={id:r,timeout_ms:e},0},rs=()=>2147483648,ns=(t,e)=>Math.ceil(t/e)*e,is=t=>{var e=Bt.buffer,r=(t-e.byteLength+65535)/65536|0;try{return Bt.grow(r),Xn(),1}catch{}},os=t=>{var e=Vn.length;t>>>=0;var r=rs();if(t>r)return!1;for(var n=1;n<=4;n*=2){var i=e*(1+.2/n);i=Math.min(i,t+100663296);var a=Math.min(r,ns(Math.max(t,i),65536)),o=is(a);if(o)return!0}return!1},as={c:Va,b:Xa,d:ts,e:os,a:ni},q,ss=g._ZSTD_isError=t=>(ss=g._ZSTD_isError=q.h)(t),ls=g._ZSTD_compressBound=t=>(ls=g._ZSTD_compressBound=q.i)(t),cs=g._ZSTD_createCCtx=()=>(cs=g._ZSTD_createCCtx=q.j)(),us=g._ZSTD_freeCCtx=t=>(us=g._ZSTD_freeCCtx=q.k)(t),fs=g._ZSTD_compress_usingDict=(t,e,r,n,i,a,o,s)=>(fs=g._ZSTD_compress_usingDict=q.l)(t,e,r,n,i,a,o,s),ds=g._ZSTD_compress=(t,e,r,n,i)=>(ds=g._ZSTD_compress=q.m)(t,e,r,n,i),hs=g._ZSTD_createDCtx=()=>(hs=g._ZSTD_createDCtx=q.n)(),ps=g._ZSTD_freeDCtx=t=>(ps=g._ZSTD_freeDCtx=q.o)(t),ms=g._ZSTD_getFrameContentSize=(t,e)=>(ms=g._ZSTD_getFrameContentSize=q.p)(t,e),gs=g._ZSTD_decompress_usingDict=(t,e,r,n,i,a,o)=>(gs=g._ZSTD_decompress_usingDict=q.q)(t,e,r,n,i,a,o),vs=g._ZSTD_decompress=(t,e,r,n)=>(vs=g._ZSTD_decompress=q.r)(t,e,r,n),ys=g._malloc=t=>(ys=g._malloc=q.s)(t),ws=g._free=t=>(ws=g._free=q.t)(t),ii=(t,e)=>(ii=q.v)(t,e),Dt;vt=function t(){Dt||oi(),Dt||(vt=t)};function oi(){if(Ze>0||(Ra(),Ze>0))return;function t(){var e;Dt||(Dt=!0,g.calledRun=!0,!zt&&(Fa(),(e=g.onRuntimeInitialized)===null||e===void 0||e.call(g),Pa()))}g.setStatus?(g.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>g.setStatus(""),1),t()},1)):t()}g.run=oi;if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);g.preInit.length>0;)g.preInit.pop()();g.init=Wa});var Ge=fe(ze=>{"use strict";var bs=ze&&ze.__awaiter||function(t,e,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{u(n.next(c))}catch(f){o(f)}}function l(c){try{u(n.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):i(c.value).then(s,l)}u((n=n.apply(t,e||[])).next())})};Object.defineProperty(ze,"__esModule",{value:!0});ze.Module=ze.waitInitialized=void 0;var si=ai();Object.defineProperty(ze,"Module",{enumerable:!0,get:function(){return si.Module}});var xs=new Promise(t=>{si.Module.onRuntimeInitialized=t}),ks=()=>bs(void 0,void 0,void 0,function*(){yield xs});ze.waitInitialized=ks});var yt=fe(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.isError=void 0;var Ms=Ge(),Es=t=>{let e=Ms.Module._ZSTD_isError;return e(t)};Rt.isError=Es});var li=fe(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.decompress=void 0;var Je=Ge(),Ts=yt(),As=(t,e)=>{let r=Je.Module._ZSTD_getFrameContentSize;return r(t,e)},Is=(t,e={defaultHeapSize:1024*1024})=>{let r=Je.Module._malloc,n=r(t.byteLength);Je.Module.HEAP8.set(t,n);let i=As(n,t.byteLength),a=i===-1?e.defaultHeapSize:i,o=Je.Module._free,s=r(a);try{let l=Je.Module._ZSTD_decompress,u=l(s,a,n,t.byteLength);if((0,Ts.isError)(u))throw new Error(`Failed to compress with code ${u}`);let c=new Uint8Array(Je.Module.HEAPU8.buffer,s,u).slice();return o(s,a),o(n,t.byteLength),c}catch(l){throw o(s,a),o(n,t.byteLength),l}};Ft.decompress=Is});var ci=fe(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.compress=void 0;var Ye=Ge(),Ss=yt(),_s=t=>{let e=Ye.Module._ZSTD_compressBound;return e(t)},Cs=(t,e)=>{let r=_s(t.byteLength),n=Ye.Module._malloc,i=n(r),a=n(t.byteLength);Ye.Module.HEAP8.set(t,a);let o=Ye.Module._free;try{let s=Ye.Module._ZSTD_compress,l=s(i,r,a,t.byteLength,e??3);if((0,Ss.isError)(l))throw new Error(`Failed to compress with code ${l}`);let u=new Uint8Array(Ye.Module.HEAPU8.buffer,i,l).slice();return o(i,r),o(a,t.byteLength),u}catch(s){throw o(i,r),o(a,t.byteLength),s}};Pt.compress=Cs});var ui=fe(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.decompressUsingDict=Le.freeDCtx=Le.createDCtx=void 0;var Ie=Ge(),Bs=yt(),Us=(t,e)=>{let r=Ie.Module._ZSTD_getFrameContentSize;return r(t,e)},Ds=()=>Ie.Module._ZSTD_createDCtx();Le.createDCtx=Ds;var zs=t=>Ie.Module._ZSTD_freeDCtx(t);Le.freeDCtx=zs;var Ls=(t,e,r,n={defaultHeapSize:1024*1024})=>{let i=Ie.Module._malloc,a=i(e.byteLength);Ie.Module.HEAP8.set(e,a);let o=i(r.byteLength);Ie.Module.HEAP8.set(r,o);let s=Us(a,e.byteLength),l=s===-1?n.defaultHeapSize:s,u=Ie.Module._free,c=i(l);try{let f=Ie.Module._ZSTD_decompress_usingDict,d=f(t,c,l,a,e.byteLength,o,r.byteLength);if((0,Bs.isError)(d))throw new Error(`Failed to compress with code ${d}`);let h=new Uint8Array(Ie.Module.HEAPU8.buffer,c,d).slice();return u(c,l),u(a,e.byteLength),u(o,r.byteLength),h}catch(f){throw u(c,l),u(a,e.byteLength),u(o,r.byteLength),f}};Le.decompressUsingDict=Ls});var fi=fe($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.compressUsingDict=$e.freeCCtx=$e.createCCtx=void 0;var Se=Ge(),$s=yt(),Rs=t=>{let e=Se.Module._ZSTD_compressBound;return e(t)},Fs=()=>Se.Module._ZSTD_createCCtx();$e.createCCtx=Fs;var Ps=t=>Se.Module._ZSTD_freeCCtx(t);$e.freeCCtx=Ps;var Os=(t,e,r,n)=>{let i=Rs(e.byteLength),a=Se.Module._malloc,o=a(i),s=a(e.byteLength);Se.Module.HEAP8.set(e,s);let l=a(r.byteLength);Se.Module.HEAP8.set(r,l);let u=Se.Module._free;try{let c=Se.Module._ZSTD_compress_usingDict,f=c(t,o,i,s,e.byteLength,l,r.byteLength,n??3);if((0,$s.isError)(f))throw new Error(`Failed to compress with code ${f}`);let d=new Uint8Array(Se.Module.HEAPU8.buffer,o,f).slice();return u(o,i),u(s,e.byteLength),u(l,r.byteLength),d}catch(c){throw u(o,i),u(s,e.byteLength),u(l,r.byteLength),c}};$e.compressUsingDict=Os});var hi=fe(te=>{"use strict";var Ns=te&&te.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Ot=te&&te.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ns(e,t,r)},Zs=te&&te.__awaiter||function(t,e,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{u(n.next(c))}catch(f){o(f)}}function l(c){try{u(n.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):i(c.value).then(s,l)}u((n=n.apply(t,e||[])).next())})};Object.defineProperty(te,"__esModule",{value:!0});te.init=void 0;var di=Ge(),Gs=()=>Zs(void 0,void 0,void 0,function*(){let{readFile:t}=require("fs/promises"),{resolve:e}=require("path"),r=yield t(e(__dirname,"./zstd.wasm"));di.Module.init(r),yield(0,di.waitInitialized)()});te.init=Gs;Ot(li(),te);Ot(ci(),te);Ot(ui(),te);Ot(fi(),te)});var Rr=fe(et=>{et.hashU32=function(e){return e=e|0,e=e+2127912214+(e<<12)|0,e=e^-949894596^e>>>19,e=e+374761393+(e<<5)|0,e=e+-744332180^e<<9,e=e+-42973499+(e<<3)|0,e^-1252372727^e>>>16|0};et.readU64=function(e,r){var n=0;return n|=e[r++]<<0,n|=e[r++]<<8,n|=e[r++]<<16,n|=e[r++]<<24,n|=e[r++]<<32,n|=e[r++]<<40,n|=e[r++]<<48,n|=e[r++]<<56,n};et.readU32=function(e,r){var n=0;return n|=e[r++]<<0,n|=e[r++]<<8,n|=e[r++]<<16,n|=e[r++]<<24,n};et.writeU32=function(e,r,n){e[r++]=n>>0&255,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255};et.imul=function(e,r){var n=e>>>16,i=e&65535,a=r>>>16,o=r&65535;return i*o+(n*o+i*a<<16)|0}});var yi=fe(vi=>{var ge=Rr(),He=2654435761,je=2246822519,pi=3266489917,Hs=668265263,mi=374761393;function Nt(t,e){return t=t|0,e=e|0,t>>>(32-e|0)|t<<e|0}function gi(t,e,r){return t=t|0,e=e|0,r=r|0,ge.imul(t>>>(32-e|0)|t<<e,r)|0}function Fr(t,e){return t=t|0,e=e|0,t>>>e^t|0}function wt(t,e,r,n,i){return gi(ge.imul(e,r)+t,n,i)}function js(t,e,r){return gi(t+ge.imul(e[r],mi),11,He)}function qs(t,e,r){return wt(t,ge.readU32(e,r),pi,17,Hs)}function Ws(t,e,r){return[wt(t[0],ge.readU32(e,r+0),je,13,He),wt(t[1],ge.readU32(e,r+4),je,13,He),wt(t[2],ge.readU32(e,r+8),je,13,He),wt(t[3],ge.readU32(e,r+12),je,13,He)]}function Vs(t,e,r,n){var i,a;if(a=n,n>=16){for(i=[t+He+je,t+je,t,t-He];n>=16;)i=Ws(i,e,r),r+=16,n-=16;i=Nt(i[0],1)+Nt(i[1],7)+Nt(i[2],12)+Nt(i[3],18)+a}else i=t+mi+n>>>0;for(;n>=4;)i=qs(i,e,r),r+=4,n-=4;for(;n>0;)i=js(i,e,r),r++,n--;return i=Fr(ge.imul(Fr(ge.imul(Fr(i,15),je),13),pi),16),i>>>0}vi.hash=Vs});var Ii=fe(W=>{var Xs=yi(),le=Rr(),Gt=4,Qs=13,wi=5,Pr=6,Ht=65536,bt=4,Zt=(1<<bt)-1,Ks=4,tt=(1<<Ks)-1,bi=Ti(5<<20),Or=Ys(),Zr=407708164,Js=4,ki=8,Mi=16,Gr=64,Nr=192,jt=2147483648,xi=7,Hr=4,Ei=7,qt={4:65536,5:262144,6:1048576,7:4194304};function Ys(){try{return new Uint32Array(Ht)}catch{for(var t=new Array(Ht),e=0;e<Ht;e++)t[e]=0;return t}}function el(t){for(var e=0;e<Ht;e++)Or[e]=0}function Ti(t){try{return new Uint8Array(t)}catch{for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e}}function Ai(t,e,r){if(typeof t.buffer!==void 0){if(Uint8Array.prototype.slice)return t.slice(e,r);var n=t.length;e=e|0,e=e<0?Math.max(n+e,0):Math.min(e,n),r=r===void 0?n:r|0,r=r<0?Math.max(n+r,0):Math.min(r,n);for(var i=new Uint8Array(r-e),a=e,o=0;a<r;)i[o++]=t[a++];return i}else return t.slice(e,r)}W.compressBound=function(e){return e+e/255+16|0};W.decompressBound=function(e){var r=0;if(le.readU32(e,r)!==Zr)throw new Error("invalid magic number");r+=4;var n=e[r++];if((n&Nr)!==Gr)throw new Error("incompatible descriptor version "+(n&Nr));var i=(n&Mi)!==0,a=(n&ki)!==0,o=e[r++]>>Hr&Ei;if(qt[o]===void 0)throw new Error("invalid block size "+o);var s=qt[o];if(a)return le.readU64(e,r);r++;for(var l=0;;){var u=le.readU32(e,r);if(r+=4,u&jt?(u&=~jt,l+=u):l+=s,u===0)return l;i&&(r+=4),r+=u}};W.makeBuffer=Ti;W.decompressBlock=function(e,r,n,i,a){var o,s,l,u,c;for(l=n+i;n<l;){var f=e[n++],d=f>>4;if(d>0){if(d===15)for(;d+=e[n],e[n++]===255;);for(u=n+d;n<u;)r[a++]=e[n++]}if(n>=l)break;if(o=f&15,s=e[n++]|e[n++]<<8,o===15)for(;o+=e[n],e[n++]===255;);for(o+=Gt,c=a-s,u=c+o;c<u;)r[a++]=r[c++]|0}return a};W.compressBlock=function(e,r,n,i,a){var o,s,l,u,c,f,d,h,p;if(d=0,h=i+n,s=n,i>=Qs)for(var m=(1<<Pr)+3;n+Gt<h-wi;){var v=le.readU32(e,n),E=le.hashU32(v)>>>0;if(E=(E>>16^E)>>>0&65535,o=a[E]-1,a[E]=n+1,o<0||n-o>>>16>0||le.readU32(e,o)!==v){c=m++>>Pr,n+=c;continue}for(m=(1<<Pr)+3,f=n-s,u=n-o,n+=Gt,o+=Gt,l=n;n<h-wi&&e[n]===e[o];)n++,o++;l=n-l;var y=l<Zt?l:Zt;if(f>=tt){for(r[d++]=(tt<<bt)+y,p=f-tt;p>=255;p-=255)r[d++]=255;r[d++]=p}else r[d++]=(f<<bt)+y;for(var b=0;b<f;b++)r[d++]=e[s+b];if(r[d++]=u,r[d++]=u>>8,l>=Zt){for(p=l-Zt;p>=255;p-=255)r[d++]=255;r[d++]=p}s=n}if(s===0)return 0;if(f=h-s,f>=tt){for(r[d++]=tt<<bt,p=f-tt;p>=255;p-=255)r[d++]=255;r[d++]=p}else r[d++]=f<<bt;for(n=s;n<h;)r[d++]=e[n++];return d};W.decompressFrame=function(e,r){var n,i,a,o,s=0,l=0;if(le.readU32(e,s)!==Zr)throw new Error("invalid magic number");if(s+=4,o=e[s++],(o&Nr)!==Gr)throw new Error("incompatible descriptor version");n=(o&Mi)!==0,i=(o&Js)!==0,a=(o&ki)!==0;var u=e[s++]>>Hr&Ei;if(qt[u]===void 0)throw new Error("invalid block size");for(a&&(s+=8),s++;;){var c;if(c=le.readU32(e,s),s+=4,c===0)break;if(n&&(s+=4),c&jt){c&=~jt;for(var f=0;f<c;f++)r[l++]=e[s++]}else l=W.decompressBlock(e,r,s,c,l),s+=c}return i&&(s+=4),l};W.compressFrame=function(e,r){var n=0;le.writeU32(r,n,Zr),n+=4,r[n++]=Gr,r[n++]=xi<<Hr,r[n]=Xs.hash(0,r,4,n-4)>>8,n++;var i=qt[xi],a=e.length,o=0;for(el(Or);a>0;){var s=0,l=a>i?i:a;if(s=W.compressBlock(e,bi,o,l,Or),s>l||s===0){le.writeU32(r,n,2147483648|l),n+=4;for(var u=o+l;o<u;)r[n++]=e[o++];a-=l}else{le.writeU32(r,n,s),n+=4;for(var c=0;c<s;)r[n++]=bi[c++];o+=l,a-=l}}return le.writeU32(r,n,0),n+=4,n};W.decompress=function(e,r){var n,i;return r===void 0&&(r=W.decompressBound(e)),n=W.makeBuffer(r),i=W.decompressFrame(e,n),i!==r&&(n=Ai(n,0,i)),n};W.compress=function(e,r){var n,i;return r===void 0&&(r=W.compressBound(e.length)),n=W.makeBuffer(r),i=W.compressFrame(e,n),i!==r&&(n=Ai(n,0,i)),n}});var ye={};cn(ye,{COMP_BR:()=>rn,COMP_LZ4:()=>tn,COMP_NONE:()=>xt,COMP_ZIP:()=>Yr,COMP_ZSTD:()=>en,FIXED_HEADER_SIZE_V1:()=>rt,MDOCX_MAGIC:()=>nr,MDOCX_MEDIA_URI_PREFIX:()=>Xt,MarkdownBundleBuilder:()=>so,MdocxBuilder:()=>sn,MediaBundleBuilder:()=>lo,MediaResolver:()=>Il,SECTION_TYPE_MARKDOWN:()=>ir,SECTION_TYPE_MEDIA:()=>Fe,createBuilder:()=>zl,createMediaIdRef:()=>Al,createSimpleDocument:()=>Dl,defaultReadLimits:()=>Xi,documentToMdocxBytes:()=>kl,documentToMdocxBytesAsync:()=>Ml,extractMediaReferences:()=>ao,findUnresolvedReferences:()=>Sl,initZstd:()=>Ki,isValidMdocx:()=>Tl,isZstdCompressionAvailable:()=>ol,parseMediaReference:()=>Qt,readMdocx:()=>bl,resolveMediaReference:()=>an,validateMdocx:()=>El,validateMdocxDetailed:()=>on,writeMdocx:()=>Qr,writeMdocxAsync:()=>Kr});function rl(t,e){if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}function nl(t){return new TextDecoder("utf-8",{fatal:!1}).decode(t)}function Qi(t){return new TextEncoder().encode(t)}async function Ki(){Vt||(await(0,Yt.init)(),Vt=!0)}function ol(){return Vt}function al(t,e,r){if(r<0)throw new Error("expectedSize < 0");switch(t){case"none":return e.byteLength,e;case"br":{let n=(0,Jt.brotliDecompressSync)(e);if(n.byteLength!==r)throw new Error(`Brotli size mismatch (got ${n.byteLength}, expected ${r})`);return n}case"zstd":{let n=qn(e);if(n.byteLength!==r)throw new Error(`ZSTD size mismatch (got ${n.byteLength}, expected ${r})`);return n}case"lz4":{let n=(0,er.decompress)(e);if(n.byteLength!==r)throw new Error(`LZ4 size mismatch (got ${n.byteLength}, expected ${r})`);return n}case"zip":{let n=Zn(e),i=Object.keys(n);if(i.length!==1||i[0]!=="payload.gob")throw new Error("ZIP must contain exactly one file named payload.gob");let a=n["payload.gob"];if(!a)throw new Error("ZIP missing payload.gob");if(a.byteLength!==r)throw new Error(`ZIP size mismatch (got ${a.byteLength}, expected ${r})`);return a}}}function Ji(t,e){switch(t){case"none":return e;case"br":return(0,Jt.brotliCompressSync)(e);case"zstd":{if(!Vt)throw new Error("ZSTD compression requires initialization. Call `await initZstd()` first, or use `compressPayloadAsync`.");return(0,Yt.compress)(e,il)}case"lz4":return(0,er.compress)(e);case"zip":return Nn({"payload.gob":e})}}async function sl(t,e){return t==="zstd"&&await Ki(),Ji(t,e)}function ae(t,e){if(t>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`${e} exceeds MAX_SAFE_INTEGER`);if(t<BigInt(Number.MIN_SAFE_INTEGER))throw new Error(`${e} below MIN_SAFE_INTEGER`);return Number(t)}function ul(t){for(let e of t)if(e!==0)return!1;return!0}function ve(t,e,r){let n=e.get(r);switch(n.kind){case"bool":return t.readGobUint()!==0n;case"int":return ae(t.readGobInt(),"int");case"uint":return ae(t.readGobUint(),"uint");case"float":{let i=t.readGobUint();if(i>0xffffffffffffffffn)throw new Error("float bits too large");let a=new ArrayBuffer(8),o=new DataView(a);return o.setBigUint64(0,i,!1),o.getFloat64(0,!1)}case"bytes":return t.readGobBytes();case"string":return t.readGobString();case"complex":{let i=ve(t,e,4),a=ve(t,e,4);return{real:i,imag:a}}case"interface":{let i=t.readGobString();if(i==="")return null;let a=ae(t.readGobInt(),"interface concrete type id");return{name:i,value:ve(t,e,a)}}case"array":{let i=ae(t.readGobUint(),"array len");if(i!==n.len)throw new Error(`Array length mismatch: got ${i}, expected ${n.len}`);if(e.get(n.elem).kind==="uint"&&n.len>0){let s=new Uint8Array(n.len);for(let l=0;l<n.len;l++){let u=ae(t.readGobUint(),"array uint elem");if(!Number.isInteger(u)||u<0||u>255)throw new Error("uint8 out of range");s[l]=u}return s}let o=[];for(let s=0;s<n.len;s++)o.push(ve(t,e,n.elem));return o}case"slice":{let i=ae(t.readGobUint(),"slice len");if(e.get(n.elem).kind==="uint"){let s=new Uint8Array(i);for(let l=0;l<i;l++){let u=ae(t.readGobUint(),"slice uint elem");if(!Number.isInteger(u)||u<0||u>255)throw new Error("uint8 out of range");s[l]=u}return s}let o=[];for(let s=0;s<i;s++)o.push(ve(t,e,n.elem));return o}case"map":{let i=ae(t.readGobUint(),"map len"),a={};for(let o=0;o<i;o++){let s=ve(t,e,n.key),l=ve(t,e,n.elem);if(typeof s!="string")throw new Error("Only string keys supported in this decoder");a[s]=l}return a}case"struct":{let i={},a=-1;for(;;){let o=ae(t.readGobUint(),"field delta");if(o===0)break;if(a+=o,a<0||a>=n.fields.length)throw new Error(`Struct field out of range: ${a} (have ${n.fields.length})`);let s=n.fields[a];i[s.name]=ve(t,e,s.typeId)}return i}}}function qe(t,e,r,n){let i=e.get(r);switch(i.kind){case"bool":{t.writeGobUint(n?1n:0n);return}case"int":{if(typeof n!="number"||!Number.isFinite(n)||!Number.isInteger(n))throw new Error("Expected int number");t.writeGobInt(BigInt(n));return}case"uint":{if(typeof n!="number"||!Number.isFinite(n)||!Number.isInteger(n)||n<0)throw new Error("Expected uint number");t.writeGobUint(BigInt(n));return}case"float":{if(typeof n!="number"||!Number.isFinite(n))throw new Error("Expected float number");let a=new ArrayBuffer(8),o=new DataView(a);o.setFloat64(0,n,!1),t.writeGobUint(o.getBigUint64(0,!1));return}case"bytes":{if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array for bytes");t.writeGobBytes(n);return}case"string":{if(typeof n!="string")throw new Error("Expected string");t.writeGobString(n);return}case"complex":throw new Error("complex not supported for encoding");case"interface":throw new Error("interface not supported for encoding");case"array":{if(!(n instanceof Uint8Array)&&!Array.isArray(n))throw new Error("Expected array");t.writeGobUint(BigInt(i.len));let a=e.get(i.elem);if(n instanceof Uint8Array){if(n.byteLength!==i.len)throw new Error("Array byte length mismatch");if(a.kind!=="uint")throw new Error("Uint8Array arrays only supported for uint elements");for(let o of n)t.writeGobUint(BigInt(o));return}if(n.length!==i.len)throw new Error("Array length mismatch");for(let o of n)qe(t,e,i.elem,o);return}case"slice":{let a=e.get(i.elem);if(n instanceof Uint8Array&&a.kind==="uint"){t.writeGobUint(BigInt(n.byteLength));for(let o of n)t.writeGobUint(BigInt(o));return}if(!Array.isArray(n))throw new Error("Expected slice as JS array");t.writeGobUint(BigInt(n.length));for(let o of n)qe(t,e,i.elem,o);return}case"map":{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Expected map object");let a=Object.entries(n);t.writeGobUint(BigInt(a.length));for(let[o,s]of a)qe(t,e,i.key,o),qe(t,e,i.elem,s);return}case"struct":{if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Expected struct object");let a=n,o=-1;for(let s=0;s<i.fields.length;s++){let l=i.fields[s],u=a[l.name],c=e.get(l.typeId),d=c.kind==="array";if(d||(u===void 0||c.kind==="string"&&u===""||(c.kind==="int"||c.kind==="uint")&&u===0||c.kind==="bytes"&&u instanceof Uint8Array&&u.byteLength===0||c.kind==="slice"&&Array.isArray(u)&&u.length===0?d=!1:d=!0),!d)continue;let h=s-o;t.writeGobUint(BigInt(h)),qe(t,e,l.typeId,u),o=s}t.writeGobUint(0n);return}}}function _i(t){let e=new Xr;return e.writeGobUint(BigInt(t.byteLength)),e.writeBytes(t),e.concat()}function fl(t,e){let r=new Vr(e);return ve(r,t,16)}function dl(t){let e=o=>{let s=t[o];if(s&&typeof s=="object"&&!Array.isArray(s))return s},r=e("ArrayT");if(r){let o=r.CommonType,s=Number(r.Elem),l=Number(r.Len);return{kind:"array",name:String(o?.Name??""),elem:s,len:l}}let n=e("SliceT");if(n){let o=n.CommonType,s=Number(n.Elem);return{kind:"slice",name:String(o?.Name??""),elem:s}}let i=e("StructT");if(i){let o=i.CommonType,s=i.Field;if(!Array.isArray(s))throw new Error("structType.Field must be an array");let l=s.map(u=>{if(!u||typeof u!="object"||Array.isArray(u))throw new Error("fieldType must be object");let c=u;return{name:String(c.Name),typeId:Number(c.Id)}});return{kind:"struct",name:String(o?.Name??""),fields:l}}let a=e("MapT");if(a){let o=a.CommonType,s=Number(a.Key),l=Number(a.Elem);return{kind:"map",name:String(o?.Name??""),key:s,elem:l}}throw new Error("Unsupported wireType (no ArrayT/SliceT/StructT/MapT)")}function Ci(t){let e=new Yi(!0),r=new Vr(t);for(;r.remaining()>0;){let n=r.readGobUint(),i=ae(n,"message length"),a=r.readBytes(i),o=new Vr(a),s=ae(o.readGobInt(),"message type id");if(s<0){let u=-s;if(u<64)throw new Error(`Received reserved/builtin type id: ${u}`);let c=fl(e,o.readBytes(o.remaining()));e.set(u,dl(c));continue}let l=ve(o,e,s);return{typeId:s,value:l}}throw new Error("No gob value found")}function Bi(t,e,r){let n=new Yi(!0);for(let[c,f]of e.entries())n.set(c,f);let i=[],a=[...e.entries()].sort((c,f)=>c[0]-f[0]);for(let[c,f]of a){let d=hl(c,f),h=new Xr;h.writeGobInt(BigInt(-c)),qe(h,n,16,d),i.push(_i(h.concat()))}let o=new Xr;o.writeGobInt(BigInt(t)),qe(o,n,t,r),i.push(_i(o.concat()));let s=i.reduce((c,f)=>c+f.byteLength,0),l=new Uint8Array(s),u=0;for(let c of i)l.set(c,u),u+=c.byteLength;return l}function hl(t,e){let r=i=>({Name:i,Id:t}),n={};if(e.kind==="array")return n.ArrayT={CommonType:r(e.name??""),Elem:e.elem,Len:e.len},n;if(e.kind==="slice")return n.SliceT={CommonType:r(e.name??""),Elem:e.elem},n;if(e.kind==="map")return n.MapT={CommonType:r(e.name??""),Key:e.key,Elem:e.elem},n;if(e.kind==="struct")return n.StructT={CommonType:r(e.name??""),Field:e.fields.map(i=>({Name:i.name,Id:i.typeId}))},n;throw new Error(`Type kind ${e.kind} cannot be sent as a user type`)}function pl(t){if(t.byteLength!==32)throw new Error("sha256 must be 32 bytes");return ul(t)?void 0:t}function Ui(t,e){if(typeof t!="string")throw new Error(`${e} must be a string`);return t}function Di(t,e){if(typeof t!="number"||!Number.isFinite(t))throw new Error(`${e} must be a number`);return t}function zi(t,e){if(!(t instanceof Uint8Array))throw new Error(`${e} must be bytes`);return t}function jr(t){if(t!==void 0){if(typeof t!="string")throw new Error("Expected optional string");return t.length?t:void 0}}function gl(t){if(t===void 0)return;if(!Array.isArray(t))throw new Error("Expected optional string array");let e=t.map(r=>{if(typeof r!="string")throw new Error("Expected string in array");return r});return e.length?e:void 0}function Li(t){if(t===void 0)return;if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Expected optional map");let e={};for(let[r,n]of Object.entries(t)){if(typeof n!="string")throw new Error("Expected string map values");e[r]=n}return Object.keys(e).length?e:void 0}function vl(t){let e=t.readBytes(8),r=t.readU16LE(),n=t.readU16LE(),i=t.readU32LE(),a=t.readU32LE(),o=t.readU32LE(),s=t.readU64LE();return{magic:e,version:r,headerFlags:n,fixedHeaderSize:i,metadataLength:a,reserved0:o,reserved1:s}}function $i(t){let e=t.readU16LE(),r=t.readU16LE(),n=t.readU64LE(),i=t.readU32LE();return{sectionType:e,sectionFlags:r,payloadLen:n,reserved:i}}function yl(t){let e=t&15,r=(t&nn)!==0;switch(e){case xt:return{alg:"none",hasUncompressedLen:r};case Yr:return{alg:"zip",hasUncompressedLen:r};case en:return{alg:"zstd",hasUncompressedLen:r};case tn:return{alg:"lz4",hasUncompressedLen:r};case rn:return{alg:"br",hasUncompressedLen:r};default:throw new Error(`Unknown compression value: 0x${e.toString(16)}`)}}function wl(t,e,r){if(e.metadataLength===0)return;if(e.metadataLength>r.maxMetadataLength)throw new Error(`MetadataLength too large: ${e.metadataLength}`);let n=t.readBytes(e.metadataLength);if(!(e.headerFlags&Jr))return{raw:n};let i=nl(n),a=JSON.parse(i);if(!a||typeof a!="object"||Array.isArray(a))throw new Error("Metadata JSON must be an object");return a}function Ri(t,e,r,n,i){if(e.sectionType!==n)throw new Error(`Unexpected section type: ${e.sectionType}, expected ${n}`);if(e.reserved!==0)throw new Error("Section reserved must be 0");if(e.payloadLen>BigInt(r.maxSectionPayloadLen))throw new Error(`Section payloadLen too large: ${e.payloadLen}`);let a=Number(e.payloadLen);if(!Number.isSafeInteger(a)||a<0)throw new Error("payloadLen is not a safe JS integer");let o=t.readBytes(a),{alg:s,hasUncompressedLen:l}=yl(e.sectionFlags);if(s==="none"){if(l)throw new Error("HAS_UNCOMPRESSED_LEN must be 0 for COMP_NONE");return o}if(!l)throw new Error("Compressed payloads MUST set HAS_UNCOMPRESSED_LEN");if(o.byteLength<8)throw new Error("Compressed payload missing UncompressedLen prefix");let c=new DataView(o.buffer,o.byteOffset,o.byteLength).getBigUint64(0,!0);if(c>BigInt(i))throw new Error(`UncompressedLen too large: ${c}`);let f=Number(c);if(!Number.isSafeInteger(f)||f<0)throw new Error("UncompressedLen is not a safe JS integer");let d=o.subarray(8);return al(s,d,f)}async function bl(t,e=Xi){let r=new tl(t);if(r.remaining()<rt)throw new Error("File too small");let n=vl(r);if(!rl(n.magic,nr))throw new Error("Bad magic");if(n.fixedHeaderSize!==rt)throw new Error(`FixedHeaderSize must be ${rt}`);if(n.version!==1)throw new Error(`Unsupported version: ${n.version}`);if(n.reserved0!==0||n.reserved1!==0n)throw new Error("Reserved header fields must be 0");let i=wl(r,n,e);if(r.remaining()<Si)throw new Error("Missing markdown section header");let a=$i(r),o=Ri(r,a,e,ir,e.maxMarkdownUncompressed);if(r.remaining()<Si)throw new Error("Missing media section header");let s=$i(r),l=new Uint8Array;if(s.payloadLen===0n){if(s.sectionType!==Fe)throw new Error(`Unexpected section type: ${s.sectionType}, expected ${Fe}`);if(s.reserved!==0)throw new Error("Section reserved must be 0");l=new Uint8Array}else l=Ri(r,s,e,Fe,e.maxMediaUncompressed);let u=new ml,c=u.decodeMarkdownBundle(o),f=l.byteLength?u.decodeMediaBundle(l):{bundleVersion:1,items:[]};return i?{header:n,metadata:i,markdown:c,media:f}:{header:n,markdown:c,media:f}}function ji(){let t=new Map;return t.set(Ni,{kind:"slice",name:"[]string",elem:Re}),t.set(Wr,{kind:"map",name:"map[string]string",key:Re,elem:Re}),t.set(Pi,{kind:"struct",name:"MarkdownFile",fields:[{name:"Path",typeId:Re},{name:"Content",typeId:Fi},{name:"MediaRefs",typeId:Ni},{name:"Attributes",typeId:Wr}]}),t.set(Oi,{kind:"slice",name:"[]MarkdownFile",elem:Pi}),t.set(eo,{kind:"struct",name:"MarkdownBundle",fields:[{name:"BundleVersion",typeId:qr},{name:"RootPath",typeId:Re},{name:"Files",typeId:Oi}]}),t.set(Hi,{kind:"array",name:"[32]uint8",elem:qr,len:32}),t.set(Zi,{kind:"struct",name:"MediaItem",fields:[{name:"ID",typeId:Re},{name:"Path",typeId:Re},{name:"MimeType",typeId:Re},{name:"Data",typeId:Fi},{name:"SHA256",typeId:Hi},{name:"Attributes",typeId:Wr}]}),t.set(Gi,{kind:"slice",name:"[]MediaItem",elem:Zi}),t.set(to,{kind:"struct",name:"MediaBundle",fields:[{name:"BundleVersion",typeId:qr},{name:"Items",typeId:Gi}]}),t}function no(t){switch(t){case"none":return xt;case"zip":return Yr;case"zstd":return en;case"lz4":return tn;case"br":return rn}}function io(t,e,r){t.writeBytes(nr),t.writeU16LE(1),t.writeU16LE(r),t.writeU32LE(rt),t.writeU32LE(e),t.writeU32LE(0),t.writeU64LE(0n)}function qi(t,e,r,n){let a=no(r),o;if(r==="none")o=n;else{a|=nn;let s=Ji(r,n),l=new or;l.writeU64LE(BigInt(n.byteLength)),l.writeBytes(s),o=l.concat()}t.writeU16LE(e),t.writeU16LE(a),t.writeU64LE(BigInt(o.byteLength)),t.writeU32LE(0),t.writeBytes(o)}async function Wi(t,e,r,n){let a=no(r),o;if(r==="none")o=n;else{a|=nn;let s=await sl(r,n),l=new or;l.writeU64LE(BigInt(n.byteLength)),l.writeBytes(s),o=l.concat()}t.writeU16LE(e),t.writeU16LE(a),t.writeU64LE(BigInt(o.byteLength)),t.writeU32LE(0),t.writeBytes(o)}function xl(t){return(0,rr.createHash)("sha256").update(t).digest()}function oo(t){let e=t.items.map(r=>r.sha256?r:{...r,sha256:xl(r.data)});return{...t,items:e}}function Qr(t,e,r={}){let n=new ro,i=n.encodeMarkdownBundle(t),a=r.autoPopulateSha256!==!1?oo(e):e,o=a.items.length?n.encodeMediaBundle(a):new Uint8Array,s=r.metadata?Qi(JSON.stringify(r.metadata)):new Uint8Array,l=r.metadata?Jr:0,u=new or;return io(u,s.byteLength,l),s.byteLength&&u.writeBytes(s),qi(u,ir,r.markdownCompression??"zip",i),o.byteLength===0?(u.writeU16LE(Fe),u.writeU16LE(xt),u.writeU64LE(0n),u.writeU32LE(0)):qi(u,Fe,r.mediaCompression??"zip",o),u.concat()}async function Kr(t,e,r={}){let n=new ro,i=n.encodeMarkdownBundle(t),a=r.autoPopulateSha256!==!1?oo(e):e,o=a.items.length?n.encodeMediaBundle(a):new Uint8Array,s=r.metadata?Qi(JSON.stringify(r.metadata)):new Uint8Array,l=r.metadata?Jr:0,u=new or;return io(u,s.byteLength,l),s.byteLength&&u.writeBytes(s),await Wi(u,ir,r.markdownCompression??"zip",i),o.byteLength===0?(u.writeU16LE(Fe),u.writeU16LE(xt),u.writeU64LE(0n),u.writeU32LE(0)):await Wi(u,Fe,r.mediaCompression??"zip",o),u.concat()}function kl(t,e={}){return t.metadata?Qr(t.markdown,t.media,{...e,metadata:t.metadata}):Qr(t.markdown,t.media,e)}async function Ml(t,e={}){return t.metadata?Kr(t.markdown,t.media,{...e,metadata:t.metadata}):Kr(t.markdown,t.media,e)}function Vi(t){if(!t||t.startsWith("/"))return!1;let e=t.split("/");return!(e.some(r=>r==="..")||e.some(r=>r.length===0))}function Wt(t){return Buffer.from(t).toString("hex")}function on(t,e={}){let r=[],n={verifyHashes:!0,checkPaths:!0,checkDuplicates:!0,warnOnMissingOptional:!1,includeInfo:!1,...e},i=(c,f,d,h)=>{if(c==="info"&&!n.includeInfo)return;let p={severity:c,message:f};d!==void 0&&(p.path=d),h!==void 0&&(p.details=h),r.push(p)};t.markdown.bundleVersion!==1&&i("error","markdown.bundleVersion must be 1","markdown.bundleVersion"),t.markdown.files.length||i("error","markdown.files must be non-empty","markdown.files");let a=new Set;t.markdown.files.forEach((c,f)=>{let d=`markdown.files[${f}]`;n.checkPaths&&!Vi(c.path)&&i("error",`Invalid markdown path: "${c.path}"`,`${d}.path`,{path:c.path}),n.checkDuplicates&&(a.has(c.path)&&i("error",`Duplicate markdown path: "${c.path}"`,`${d}.path`),a.add(c.path)),n.warnOnMissingOptional&&(c.mediaRefs?.length||i("info","No media references",`${d}.mediaRefs`))}),t.media.bundleVersion!==1&&i("error","media.bundleVersion must be 1","media.bundleVersion");let o=new Set;t.media.items.forEach((c,f)=>{let d=`media.items[${f}]`;if(c.id||i("error","MediaItem.id must be non-empty",`${d}.id`),n.checkDuplicates&&(o.has(c.id)&&i("error",`Duplicate media ID: "${c.id}"`,`${d}.id`),o.add(c.id)),n.checkPaths&&c.path&&!Vi(c.path)&&i("error",`Invalid media path: "${c.path}"`,`${d}.path`,{path:c.path}),n.verifyHashes&&c.sha256)if(c.sha256.byteLength!==32)i("error",`MediaItem.sha256 must be 32 bytes for id="${c.id}"`,`${d}.sha256`);else{let h=(0,rr.createHash)("sha256").update(c.data).digest();Wt(h)!==Wt(c.sha256)&&i("error",`MediaItem.sha256 mismatch for id="${c.id}"`,`${d}.sha256`,{stored:Wt(c.sha256),computed:Wt(h)})}n.warnOnMissingOptional&&(c.mimeType||i("warning",`Missing MIME type for id="${c.id}"`,`${d}.mimeType`),c.sha256||i("warning",`Missing SHA256 hash for id="${c.id}"`,`${d}.sha256`))});let s={markdownFileCount:t.markdown.files.length,mediaItemCount:t.media.items.length,totalMarkdownBytes:t.markdown.files.reduce((c,f)=>c+f.content.byteLength,0),totalMediaBytes:t.media.items.reduce((c,f)=>c+f.data.byteLength,0)},l=r.filter(c=>c.severity==="error").length,u=r.filter(c=>c.severity==="warning").length;return{valid:l===0,issues:r,errorCount:l,warningCount:u,stats:s}}function El(t){return on(t).issues.filter(r=>r.severity==="error").map(r=>r.message)}function Tl(t){return on(t).valid}function Qt(t){if(t){if(t.startsWith(Xt)){let e=t.slice(Xt.length);return e?{type:"id",id:e}:void 0}if(!t.includes("://"))return{type:"path",path:t}}}function Al(t){return`${Xt}${t}`}function an(t,e,r){let n=Qt(t);if(!n)return;if(n.type==="id")return e.items.find(a=>a.id===n.id);let i=Kt(n.path,r);return e.items.find(a=>a.path&&Kt(a.path)===i)}function Kt(t,e){if(e&&!t.startsWith("/")){let i=e.includes("/")?e.substring(0,e.lastIndexOf("/")):"";t=i?`${i}/${t}`:t}let r=t.split("/").filter(i=>i&&i!=="."),n=[];for(let i of r)i===".."?n.pop():n.push(i);return n.join("/")}function ao(t){let e=typeof t=="string"?t:new TextDecoder().decode(t),r=new Set,n=/!?\[([^\]]*)\]\(([^)]+)\)/g,i;for(;(i=n.exec(e))!==null;){let o=i[2];if(o){let s=o.split(/\s+/)[0];s&&Qt(s)&&r.add(s)}}let a=/<img[^>]+src=["']([^"']+)["']/gi;for(;(i=a.exec(e))!==null;){let o=i[1];o&&Qt(o)&&r.add(o)}return[...r]}function Sl(t,e){let r=ao(t.content),n=[];for(let i of r)an(i,e,t.path)||n.push(i);return n}function _l(t){return typeof t=="string"?new TextEncoder().encode(t):t}function Cl(t){return(0,rr.createHash)("sha256").update(t).digest()}function Bl(t){let e=t.split(".").pop()?.toLowerCase();return e?{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml",ico:"image/x-icon",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",mp4:"video/mp4",webm:"video/webm",pdf:"application/pdf",json:"application/json",xml:"application/xml",zip:"application/zip",txt:"text/plain",css:"text/css",js:"application/javascript",html:"text/html",md:"text/markdown",markdown:"text/markdown"}[e]??"application/octet-stream":"application/octet-stream"}function Ul(t){return t.replace(/[^a-zA-Z0-9_-]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")}function Dl(t,e,r){let n=new sn().addMarkdown(t,e).root(t);return r&&n.setMetadata(r),n.build()}function zl(){return new sn}var Jt,Yt,er,tr,rr,Xi,nr,rt,Jr,ir,Fe,Si,xt,Yr,en,tn,rn,nn,tl,or,il,Vt,ll,cl,Vr,Xr,Yi,ml,qr,Fi,Re,eo,Pi,Oi,Ni,Wr,to,Zi,Gi,Hi,ro,Xt,Il,so,lo,sn,we=ur(()=>{Jt=require("zlib");Gn();Wn();Yt=We(hi(),1),er=We(Ii(),1),tr=require("util"),rr=require("crypto"),Xi={maxMetadataLength:1024*1024,maxSectionPayloadLen:1024*1024*1024,maxMarkdownUncompressed:256*1024*1024,maxMediaUncompressed:2*1024*1024*1024},nr=Uint8Array.from([77,68,79,67,88,13,10,26]),rt=32,Jr=1,ir=1,Fe=2,Si=16,xt=0,Yr=1,en=2,tn=3,rn=4,nn=16,tl=class{view;buf;offset=0;constructor(t){this.buf=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}remaining(){return this.buf.byteLength-this.offset}readBytes(t){if(t<0)throw new Error("readBytes: negative length");if(this.offset+t>this.buf.byteLength)throw new Error(`Unexpected EOF (need ${t}, have ${this.remaining()})`);let e=this.buf.subarray(this.offset,this.offset+t);return this.offset+=t,e}readU16LE(){let t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}readU32LE(){let t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}readU64LE(){let t=this.view.getBigUint64(this.offset,!0);return this.offset+=8,t}},or=class{chunks=[];writeBytes(t){this.chunks.push(t)}writeU16LE(t){let e=new Uint8Array(2);new DataView(e.buffer).setUint16(0,t,!0),this.chunks.push(e)}writeU32LE(t){let e=new Uint8Array(4);new DataView(e.buffer).setUint32(0,t,!0),this.chunks.push(e)}writeU64LE(t){let e=new Uint8Array(8);new DataView(e.buffer).setBigUint64(0,t,!0),this.chunks.push(e)}concat(){let t=this.chunks.reduce((n,i)=>n+i.byteLength,0),e=new Uint8Array(t),r=0;for(let n of this.chunks)e.set(n,r),r+=n.byteLength;return e}};il=3,Vt=!1;ll=new tr.TextDecoder,cl=new tr.TextEncoder,Vr=class{constructor(t){this.bytes=t}off=0;remaining(){return this.bytes.byteLength-this.off}readByte(){if(this.off>=this.bytes.byteLength)throw new Error("Unexpected EOF");return this.bytes[this.off++]}readBytes(t){if(t<0)throw new Error("Invalid length");if(this.off+t>this.bytes.byteLength)throw new Error("Unexpected EOF");let e=this.bytes.subarray(this.off,this.off+t);return this.off+=t,e}readGobUint(){let t=this.readByte();if(t<=127)return BigInt(t);let e=256-t,r=0n;for(let n=0;n<e;n++)r=r<<8n|BigInt(this.readByte());return r}readGobInt(){let t=this.readGobUint();return(t&1n)===0n?t>>1n:~(t>>1n)}readGobString(){let t=this.readGobUint(),e=ae(t,"string length"),r=this.readBytes(e);return ll.decode(r)}readGobBytes(){let t=this.readGobUint(),e=ae(t,"bytes length");return this.readBytes(e)}},Xr=class{chunks=[];writeByte(t){let e=new Uint8Array(1);e[0]=t&255,this.chunks.push(e)}writeBytes(t){this.chunks.push(t)}writeGobUint(t){if(t<0n)throw new Error("uint must be non-negative");if(t<=0x7fn){this.writeByte(Number(t));return}let e=[],r=t;for(;r>0n;)e.push(Number(r&0xffn)),r>>=8n;if(e.reverse(),e.length>255)throw new Error("uint too large");this.writeByte(256-e.length),this.writeBytes(Uint8Array.from(e))}writeGobInt(t){if(t<0n){let e=~t<<1n|1n;this.writeGobUint(e)}else{let e=t<<1n;this.writeGobUint(e)}}writeGobString(t){let e=cl.encode(t);this.writeGobUint(BigInt(e.byteLength)),this.writeBytes(e)}writeGobBytes(t){this.writeGobUint(BigInt(t.byteLength)),this.writeBytes(t)}concat(){let t=this.chunks.reduce((n,i)=>n+i.byteLength,0),e=new Uint8Array(t),r=0;for(let n of this.chunks)e.set(n,r),r+=n.byteLength;return e}};Yi=class{types=new Map;constructor(t){t&&(this.types.set(1,{kind:"bool"}),this.types.set(2,{kind:"int"}),this.types.set(3,{kind:"uint"}),this.types.set(4,{kind:"float"}),this.types.set(5,{kind:"bytes"}),this.types.set(6,{kind:"string"}),this.types.set(7,{kind:"complex"}),this.types.set(8,{kind:"interface"}),this.types.set(18,{kind:"struct",name:"CommonType",fields:[{name:"Name",typeId:6},{name:"Id",typeId:2}]}),this.types.set(17,{kind:"struct",name:"arrayType",fields:[{name:"CommonType",typeId:18},{name:"Elem",typeId:2},{name:"Len",typeId:2}]}),this.types.set(19,{kind:"struct",name:"sliceType",fields:[{name:"CommonType",typeId:18},{name:"Elem",typeId:2}]}),this.types.set(21,{kind:"struct",name:"fieldType",fields:[{name:"Name",typeId:6},{name:"Id",typeId:2}]}),this.types.set(22,{kind:"slice",name:"[]fieldType",elem:21}),this.types.set(20,{kind:"struct",name:"structType",fields:[{name:"CommonType",typeId:18},{name:"Field",typeId:22}]}),this.types.set(23,{kind:"struct",name:"mapType",fields:[{name:"CommonType",typeId:18},{name:"Key",typeId:2},{name:"Elem",typeId:2}]}),this.types.set(16,{kind:"struct",name:"wireType",fields:[{name:"ArrayT",typeId:17},{name:"SliceT",typeId:19},{name:"StructT",typeId:20},{name:"MapT",typeId:23}]}))}get(t){let e=this.types.get(t);if(!e)throw new Error(`Unknown gob type id: ${t}`);return e}has(t){return this.types.has(t)}set(t,e){this.types.set(t,e)}};ml=class{decodeMarkdownBundle(t){let r=Ci(t).value;if(!r||typeof r!="object"||Array.isArray(r))throw new Error("MarkdownBundle gob must decode to an object");let n=r,i=Di(n.BundleVersion,"BundleVersion"),a=jr(n.RootPath),o=n.Files;if(!Array.isArray(o))throw new Error("Files must be an array");let s=o.map((l,u)=>{if(!l||typeof l!="object"||Array.isArray(l))throw new Error(`Files[${u}] must be an object`);let c=l,f=Ui(c.Path,"Path"),d=c.Content===void 0?new Uint8Array:zi(c.Content,"Content"),h=gl(c.MediaRefs),p=Li(c.Attributes);return{path:f,content:d,...h?{mediaRefs:h}:{},...p?{attributes:p}:{}}});return{bundleVersion:i,...a?{rootPath:a}:{},files:s}}decodeMediaBundle(t){let r=Ci(t).value;if(!r||typeof r!="object"||Array.isArray(r))throw new Error("MediaBundle gob must decode to an object");let n=r,i=Di(n.BundleVersion,"BundleVersion"),a=n.Items;if(a===void 0)return{bundleVersion:i,items:[]};if(!Array.isArray(a))throw new Error("Items must be an array");let o=a.map((s,l)=>{if(!s||typeof s!="object"||Array.isArray(s))throw new Error(`Items[${l}] must be an object`);let u=s,c=Ui(u.ID,"ID"),f=jr(u.Path),d=jr(u.MimeType??u.MIMEType),h=u.Data===void 0?new Uint8Array:zi(u.Data,"Data"),p=u.SHA256,m=p instanceof Uint8Array?pl(p):void 0,v=Li(u.Attributes);return{id:c,...f?{path:f}:{},...d?{mimeType:d}:{},data:h,...m?{sha256:m}:{},...v?{attributes:v}:{}}});return{bundleVersion:i,items:o}}};qr=3,Fi=5,Re=6,eo=65,Pi=66,Oi=67,Ni=68,Wr=69,to=70,Zi=71,Gi=72,Hi=73;ro=class{encodeMarkdownBundle(t){let e=ji(),r={BundleVersion:t.bundleVersion,RootPath:t.rootPath??"",Files:t.files.map(n=>({Path:n.path,Content:n.content,MediaRefs:n.mediaRefs??[],...n.attributes?{Attributes:n.attributes}:{}}))};return Bi(eo,e,r)}encodeMediaBundle(t){let e=ji(),r={BundleVersion:t.bundleVersion,Items:t.items.map(n=>({ID:n.id,Path:n.path??"",MimeType:n.mimeType??"",Data:n.data,SHA256:n.sha256??new Uint8Array(32),...n.attributes?{Attributes:n.attributes}:{}}))};return Bi(to,e,r)}};Xt="mdocx://media/";Il=class{constructor(t){this.doc=t}resolve(t,e){return an(t,this.doc.media,e?.path)}getById(t){return this.doc.media.items.find(e=>e.id===t)}getByPath(t){let e=Kt(t);return this.doc.media.items.find(r=>r.path&&Kt(r.path)===e)}getReferencedMedia(t){if(!t.mediaRefs)return[];let e=[];for(let r of t.mediaRefs){let n=this.getById(r);n&&e.push(n)}return e}getAllMedia(){return[...this.doc.media.items]}hasId(t){return this.doc.media.items.some(e=>e.id===t)}getMimeType(t){return t.mimeType??"application/octet-stream"}};so=class{files=[];rootPath;root(t){return this.rootPath=t,this}addFile(t,e,r={}){return this.files.push({path:t,content:_l(e),...r.mediaRefs?.length?{mediaRefs:r.mediaRefs}:{},...r.attributes&&Object.keys(r.attributes).length?{attributes:r.attributes}:{}}),this}addFiles(t){for(let e of t)this.addFile(e.path,e.content,e);return this}build(){if(this.files.length===0)throw new Error("MarkdownBundle must contain at least one file");return{bundleVersion:1,...this.rootPath?{rootPath:this.rootPath}:{},files:this.files}}},lo=class{items=[];usedIds=new Set;addItem(t,e,r={}){if(this.usedIds.has(t))throw new Error(`Duplicate media ID: ${t}`);this.usedIds.add(t);let n={id:t,data:e,...r.path?{path:r.path}:{},mimeType:r.mimeType??(r.path?Bl(r.path):"application/octet-stream"),...r.computeSha256!==!1?{sha256:Cl(e)}:{},...r.attributes&&Object.keys(r.attributes).length?{attributes:r.attributes}:{}};return this.items.push(n),this}addFromPath(t,e,r={}){let n=Ul(t);return this.addItem(n,e,{...r,path:t})}addItems(t){for(let e of t)this.addItem(e.id,e.data,e);return this}build(){return{bundleVersion:1,items:this.items}}static empty(){return{bundleVersion:1,items:[]}}},sn=class{markdownBuilder=new so;mediaBuilder=new lo;metadata;setMetadata(t){return this.metadata=t,this}addMetadata(t){return this.metadata={...this.metadata??{},...t},this}title(t){return this.addMetadata({title:t})}description(t){return this.addMetadata({description:t})}root(t){return this.markdownBuilder.root(t),this.addMetadata({root:t}),this}addMarkdown(t,e,r={}){return this.markdownBuilder.addFile(t,e,r),this}addMedia(t,e,r={}){return this.mediaBuilder.addItem(t,e,r),this}addMediaFromPath(t,e,r={}){return this.mediaBuilder.addFromPath(t,e,r),this}markdown(){return this.markdownBuilder}media(){return this.mediaBuilder}build(){let e={header:{magic:nr,version:1,headerFlags:this.metadata?1:0,fixedHeaderSize:rt,metadataLength:0,reserved0:0,reserved1:0n},markdown:this.markdownBuilder.build(),media:this.mediaBuilder.build()};return this.metadata&&(e.metadata=this.metadata),e}}});var Fl={};cn(Fl,{activate:()=>$l,deactivate:()=>Rl});module.exports=mo(Fl);var B=We(require("vscode")),ln=require("buffer"),Ce=We(require("path")),ar=require("util");function hr(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Oe=hr();function gn(t){Oe=t}var vn=/[&<>"']/,go=new RegExp(vn.source,"g"),yn=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,vo=new RegExp(yn.source,"g"),yo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fn=t=>yo[t];function ie(t,e){if(e){if(vn.test(t))return t.replace(go,fn)}else if(yn.test(t))return t.replace(vo,fn);return t}var wo=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function bo(t){return t.replace(wo,(e,r)=>(r=r.toLowerCase(),r==="colon"?":":r.charAt(0)==="#"?r.charAt(1)==="x"?String.fromCharCode(parseInt(r.substring(2),16)):String.fromCharCode(+r.substring(1)):""))}var xo=/(^|[^\[])\^/g;function $(t,e){let r=typeof t=="string"?t:t.source;e=e||"";let n={replace:(i,a)=>{let o=typeof a=="string"?a:a.source;return o=o.replace(xo,"$1"),r=r.replace(i,o),n},getRegex:()=>new RegExp(r,e)};return n}function dn(t){try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}var it={exec:()=>null};function hn(t,e){let r=t.replace(/\|/g,(a,o,s)=>{let l=!1,u=o;for(;--u>=0&&s[u]==="\\";)l=!l;return l?"|":" |"}),n=r.split(/ \|/),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n[n.length-1].trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(/\\\|/g,"|");return n}function Mt(t,e,r){let n=t.length;if(n===0)return"";let i=0;for(;i<n;){let a=t.charAt(n-i-1);if(a===e&&!r)i++;else if(a!==e&&r)i++;else break}return t.slice(0,n-i)}function ko(t,e){if(t.indexOf(e[1])===-1)return-1;let r=0;for(let n=0;n<t.length;n++)if(t[n]==="\\")n++;else if(t[n]===e[0])r++;else if(t[n]===e[1]&&(r--,r<0))return n;return-1}function pn(t,e,r,n){let i=e.href,a=e.title?ie(e.title):null,o=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){n.state.inLink=!0;let s={type:"link",raw:r,href:i,title:a,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,s}return{type:"image",raw:r,href:i,title:a,text:ie(o)}}function Mo(t,e){let r=t.match(/^(\s+)(?:```)/);if(r===null)return e;let n=r[1];return e.split(`
`).map(i=>{let a=i.match(/^\s+/);if(a===null)return i;let[o]=a;return o.length>=n.length?i.slice(n.length):i}).join(`
`)}var Xe=class{options;rules;lexer;constructor(e){this.options=e||Oe}space(e){let r=this.rules.block.newline.exec(e);if(r&&r[0].length>0)return{type:"space",raw:r[0]}}code(e){let r=this.rules.block.code.exec(e);if(r){let n=r[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:r[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Mt(n,`
`)}}}fences(e){let r=this.rules.block.fences.exec(e);if(r){let n=r[0],i=Mo(n,r[3]||"");return{type:"code",raw:n,lang:r[2]?r[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):r[2],text:i}}}heading(e){let r=this.rules.block.heading.exec(e);if(r){let n=r[2].trim();if(/#$/.test(n)){let i=Mt(n,"#");(this.options.pedantic||!i||/ $/.test(i))&&(n=i.trim())}return{type:"heading",raw:r[0],depth:r[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let r=this.rules.block.hr.exec(e);if(r)return{type:"hr",raw:r[0]}}blockquote(e){let r=this.rules.block.blockquote.exec(e);if(r){let n=r[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);n=Mt(n.replace(/^ *>[ \t]?/gm,""),`
`);let i=this.lexer.state.top;this.lexer.state.top=!0;let a=this.lexer.blockTokens(n);return this.lexer.state.top=i,{type:"blockquote",raw:r[0],tokens:a,text:n}}}list(e){let r=this.rules.block.list.exec(e);if(r){let n=r[1].trim(),i=n.length>1,a={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");let o=new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),s="",l="",u=!1;for(;e;){let c=!1;if(!(r=o.exec(e))||this.rules.block.hr.test(e))break;s=r[0],e=e.substring(s.length);let f=r[2].split(`
`,1)[0].replace(/^\t+/,E=>" ".repeat(3*E.length)),d=e.split(`
`,1)[0],h=0;this.options.pedantic?(h=2,l=f.trimStart()):(h=r[2].search(/[^ ]/),h=h>4?1:h,l=f.slice(h),h+=r[1].length);let p=!1;if(!f&&/^ *$/.test(d)&&(s+=d+`
`,e=e.substring(d.length+1),c=!0),!c){let E=new RegExp(`^ {0,${Math.min(3,h-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),y=new RegExp(`^ {0,${Math.min(3,h-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),b=new RegExp(`^ {0,${Math.min(3,h-1)}}(?:\`\`\`|~~~)`),S=new RegExp(`^ {0,${Math.min(3,h-1)}}#`);for(;e;){let T=e.split(`
`,1)[0];if(d=T,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),b.test(d)||S.test(d)||E.test(d)||y.test(e))break;if(d.search(/[^ ]/)>=h||!d.trim())l+=`
`+d.slice(h);else{if(p||f.search(/[^ ]/)>=4||b.test(f)||S.test(f)||y.test(f))break;l+=`
`+d}!p&&!d.trim()&&(p=!0),s+=T+`
`,e=e.substring(T.length+1),f=d.slice(h)}}a.loose||(u?a.loose=!0:/\n *\n *$/.test(s)&&(u=!0));let m=null,v;this.options.gfm&&(m=/^\[[ xX]\] /.exec(l),m&&(v=m[0]!=="[ ] ",l=l.replace(/^\[[ xX]\] +/,""))),a.items.push({type:"list_item",raw:s,task:!!m,checked:v,loose:!1,text:l,tokens:[]}),a.raw+=s}a.items[a.items.length-1].raw=s.trimEnd(),a.items[a.items.length-1].text=l.trimEnd(),a.raw=a.raw.trimEnd();for(let c=0;c<a.items.length;c++)if(this.lexer.state.top=!1,a.items[c].tokens=this.lexer.blockTokens(a.items[c].text,[]),!a.loose){let f=a.items[c].tokens.filter(h=>h.type==="space"),d=f.length>0&&f.some(h=>/\n.*\n/.test(h.raw));a.loose=d}if(a.loose)for(let c=0;c<a.items.length;c++)a.items[c].loose=!0;return a}}html(e){let r=this.rules.block.html.exec(e);if(r)return{type:"html",block:!0,raw:r[0],pre:r[1]==="pre"||r[1]==="script"||r[1]==="style",text:r[0]}}def(e){let r=this.rules.block.def.exec(e);if(r){let n=r[1].toLowerCase().replace(/\s+/g," "),i=r[2]?r[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=r[3]?r[3].substring(1,r[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):r[3];return{type:"def",tag:n,raw:r[0],href:i,title:a}}}table(e){let r=this.rules.block.table.exec(e);if(!r||!/[:|]/.test(r[2]))return;let n=hn(r[1]),i=r[2].replace(/^\||\| *$/g,"").split("|"),a=r[3]&&r[3].trim()?r[3].replace(/\n[ \t]*$/,"").split(`
`):[],o={type:"table",raw:r[0],header:[],align:[],rows:[]};if(n.length===i.length){for(let s of i)/^ *-+: *$/.test(s)?o.align.push("right"):/^ *:-+: *$/.test(s)?o.align.push("center"):/^ *:-+ *$/.test(s)?o.align.push("left"):o.align.push(null);for(let s of n)o.header.push({text:s,tokens:this.lexer.inline(s)});for(let s of a)o.rows.push(hn(s,o.header.length).map(l=>({text:l,tokens:this.lexer.inline(l)})));return o}}lheading(e){let r=this.rules.block.lheading.exec(e);if(r)return{type:"heading",raw:r[0],depth:r[2].charAt(0)==="="?1:2,text:r[1],tokens:this.lexer.inline(r[1])}}paragraph(e){let r=this.rules.block.paragraph.exec(e);if(r){let n=r[1].charAt(r[1].length-1)===`
`?r[1].slice(0,-1):r[1];return{type:"paragraph",raw:r[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let r=this.rules.block.text.exec(e);if(r)return{type:"text",raw:r[0],text:r[0],tokens:this.lexer.inline(r[0])}}escape(e){let r=this.rules.inline.escape.exec(e);if(r)return{type:"escape",raw:r[0],text:ie(r[1])}}tag(e){let r=this.rules.inline.tag.exec(e);if(r)return!this.lexer.state.inLink&&/^<a /i.test(r[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(r[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(r[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(r[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:r[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:r[0]}}link(e){let r=this.rules.inline.link.exec(e);if(r){let n=r[2].trim();if(!this.options.pedantic&&/^</.test(n)){if(!/>$/.test(n))return;let o=Mt(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{let o=ko(r[2],"()");if(o>-1){let l=(r[0].indexOf("!")===0?5:4)+r[1].length+o;r[2]=r[2].substring(0,o),r[0]=r[0].substring(0,l).trim(),r[3]=""}}let i=r[2],a="";if(this.options.pedantic){let o=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);o&&(i=o[1],a=o[3])}else a=r[3]?r[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(n)?i=i.slice(1):i=i.slice(1,-1)),pn(r,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},r[0],this.lexer)}}reflink(e,r){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let i=(n[2]||n[1]).replace(/\s+/g," "),a=r[i.toLowerCase()];if(!a){let o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return pn(n,a,n[0],this.lexer)}}emStrong(e,r,n=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!i||i[3]&&n.match(/[\p{L}\p{N}]/u))return;if(!(i[1]||i[2]||"")||!n||this.rules.inline.punctuation.exec(n)){let o=[...i[0]].length-1,s,l,u=o,c=0,f=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,r=r.slice(-1*e.length+o);(i=f.exec(r))!=null;){if(s=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!s)continue;if(l=[...s].length,i[3]||i[4]){u+=l;continue}else if((i[5]||i[6])&&o%3&&!((o+l)%3)){c+=l;continue}if(u-=l,u>0)continue;l=Math.min(l,l+u+c);let d=[...i[0]][0].length,h=e.slice(0,o+i.index+d+l);if(Math.min(o,l)%2){let m=h.slice(1,-1);return{type:"em",raw:h,text:m,tokens:this.lexer.inlineTokens(m)}}let p=h.slice(2,-2);return{type:"strong",raw:h,text:p,tokens:this.lexer.inlineTokens(p)}}}}codespan(e){let r=this.rules.inline.code.exec(e);if(r){let n=r[2].replace(/\n/g," "),i=/[^ ]/.test(n),a=/^ /.test(n)&&/ $/.test(n);return i&&a&&(n=n.substring(1,n.length-1)),n=ie(n,!0),{type:"codespan",raw:r[0],text:n}}}br(e){let r=this.rules.inline.br.exec(e);if(r)return{type:"br",raw:r[0]}}del(e){let r=this.rules.inline.del.exec(e);if(r)return{type:"del",raw:r[0],text:r[2],tokens:this.lexer.inlineTokens(r[2])}}autolink(e){let r=this.rules.inline.autolink.exec(e);if(r){let n,i;return r[2]==="@"?(n=ie(r[1]),i="mailto:"+n):(n=ie(r[1]),i=n),{type:"link",raw:r[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e){let r;if(r=this.rules.inline.url.exec(e)){let n,i;if(r[2]==="@")n=ie(r[0]),i="mailto:"+n;else{let a;do a=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])?.[0]??"";while(a!==r[0]);n=ie(r[0]),r[1]==="www."?i="http://"+r[0]:i=r[0]}return{type:"link",raw:r[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){let r=this.rules.inline.text.exec(e);if(r){let n;return this.lexer.state.inRawBlock?n=r[0]:n=ie(r[0]),{type:"text",raw:r[0],text:n}}}},Eo=/^(?: *(?:\n|$))+/,To=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,Ao=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,at=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Io=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,wn=/(?:[*+-]|\d{1,9}[.)])/,bn=$(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,wn).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),pr=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,So=/^[^\n]+/,mr=/(?!\s*\])(?:\\.|[^\[\]\\])+/,_o=$(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",mr).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Co=$(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,wn).getRegex(),At="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",gr=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Bo=$("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",gr).replace("tag",At).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),xn=$(pr).replace("hr",at).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex(),Uo=$(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",xn).getRegex(),vr={blockquote:Uo,code:To,def:_o,fences:Ao,heading:Io,hr:at,html:Bo,lheading:bn,list:Co,newline:Eo,paragraph:xn,table:it,text:So},mn=$("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",at).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex(),Do={...vr,table:mn,paragraph:$(pr).replace("hr",at).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",mn).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex()},zo={...vr,html:$(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",gr).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:it,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:$(pr).replace("hr",at).replace("heading",` *#{1,6} *[^
]`).replace("lheading",bn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},kn=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Lo=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Mn=/^( {2,}|\\)\n(?!\s*$)/,$o=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,st="\\p{P}\\p{S}",Ro=$(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,st).getRegex(),Fo=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,Po=$(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,st).getRegex(),Oo=$("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,st).getRegex(),No=$("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,st).getRegex(),Zo=$(/\\([punct])/,"gu").replace(/punct/g,st).getRegex(),Go=$(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ho=$(gr).replace("(?:-->|$)","-->").getRegex(),jo=$("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ho).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Tt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,qo=$(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Tt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),En=$(/^!?\[(label)\]\[(ref)\]/).replace("label",Tt).replace("ref",mr).getRegex(),Tn=$(/^!?\[(ref)\](?:\[\])?/).replace("ref",mr).getRegex(),Wo=$("reflink|nolink(?!\\()","g").replace("reflink",En).replace("nolink",Tn).getRegex(),yr={_backpedal:it,anyPunctuation:Zo,autolink:Go,blockSkip:Fo,br:Mn,code:Lo,del:it,emStrongLDelim:Po,emStrongRDelimAst:Oo,emStrongRDelimUnd:No,escape:kn,link:qo,nolink:Tn,punctuation:Ro,reflink:En,reflinkSearch:Wo,tag:jo,text:$o,url:it},Vo={...yr,link:$(/^!?\[(label)\]\((.*?)\)/).replace("label",Tt).getRegex(),reflink:$(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Tt).getRegex()},fr={...yr,escape:$(kn).replace("])","~|])").getRegex(),url:$(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Xo={...fr,br:$(Mn).replace("{2,}","*").getRegex(),text:$(fr.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Et={normal:vr,gfm:Do,pedantic:zo},nt={normal:yr,gfm:fr,breaks:Xo,pedantic:Vo},Me=class t{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Oe,this.options.tokenizer=this.options.tokenizer||new Xe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={block:Et.normal,inline:nt.normal};this.options.pedantic?(r.block=Et.pedantic,r.inline=nt.pedantic):this.options.gfm&&(r.block=Et.gfm,this.options.breaks?r.inline=nt.breaks:r.inline=nt.gfm),this.tokenizer.rules=r}static get rules(){return{block:Et,inline:nt}}static lex(e,r){return new t(r).lex(e)}static lexInline(e,r){return new t(r).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,r=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(s,l,u)=>l+"    ".repeat(u.length));let n,i,a,o;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(s=>(n=s.call({lexer:this},e,r))?(e=e.substring(n.raw.length),r.push(n),!0):!1))){if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length),n.raw.length===1&&r.length>0?r[r.length-1].raw+=`
`:r.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length),i=r[r.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text):r.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length),i=r[r.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+n.raw,i.text+=`
`+n.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),r.push(n);continue}if(a=e,this.options.extensions&&this.options.extensions.startBlock){let s=1/0,l=e.slice(1),u;this.options.extensions.startBlock.forEach(c=>{u=c.call({lexer:this},l),typeof u=="number"&&u>=0&&(s=Math.min(s,u))}),s<1/0&&s>=0&&(a=e.substring(0,s+1))}if(this.state.top&&(n=this.tokenizer.paragraph(a))){i=r[r.length-1],o&&i.type==="paragraph"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):r.push(n),o=a.length!==e.length,e=e.substring(n.raw.length);continue}if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length),i=r[r.length-1],i&&i.type==="text"?(i.raw+=`
`+n.raw,i.text+=`
`+n.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):r.push(n);continue}if(e){let s="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(s);break}else throw new Error(s)}}return this.state.top=!0,r}inline(e,r=[]){return this.inlineQueue.push({src:e,tokens:r}),r}inlineTokens(e,r=[]){let n,i,a,o=e,s,l,u;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(o))!=null;)c.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(o=o.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.blockSkip.exec(o))!=null;)o=o.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+o.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(o))!=null;)o=o.slice(0,s.index)+"++"+o.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(l||(u=""),l=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(n=c.call({lexer:this},e,r))?(e=e.substring(n.raw.length),r.push(n),!0):!1))){if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),i=r[r.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):r.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length),i=r[r.length-1],i&&n.type==="text"&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):r.push(n);continue}if(n=this.tokenizer.emStrong(e,o,u)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),r.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),r.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),r.push(n);continue}if(a=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0,f=e.slice(1),d;this.options.extensions.startInline.forEach(h=>{d=h.call({lexer:this},f),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(a=e.substring(0,c+1))}if(n=this.tokenizer.inlineText(a)){e=e.substring(n.raw.length),n.raw.slice(-1)!=="_"&&(u=n.raw.slice(-1)),l=!0,i=r[r.length-1],i&&i.type==="text"?(i.raw+=n.raw,i.text+=n.text):r.push(n);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return r}},Qe=class{options;constructor(e){this.options=e||Oe}code(e,r,n){let i=(r||"").match(/^\S*/)?.[0];return e=e.replace(/\n$/,"")+`
`,i?'<pre><code class="language-'+ie(i)+'">'+(n?e:ie(e,!0))+`</code></pre>
`:"<pre><code>"+(n?e:ie(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,r){return e}heading(e,r,n){return`<h${r}>${e}</h${r}>
`}hr(){return`<hr>
`}list(e,r,n){let i=r?"ol":"ul",a=r&&n!==1?' start="'+n+'"':"";return"<"+i+a+`>
`+e+"</"+i+`>
`}listitem(e,r,n){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,r){return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,r){let n=r.header?"th":"td";return(r.align?`<${n} align="${r.align}">`:`<${n}>`)+e+`</${n}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,r,n){let i=dn(e);if(i===null)return n;e=i;let a='<a href="'+e+'"';return r&&(a+=' title="'+r+'"'),a+=">"+n+"</a>",a}image(e,r,n){let i=dn(e);if(i===null)return n;e=i;let a=`<img src="${e}" alt="${n}"`;return r&&(a+=` title="${r}"`),a+=">",a}text(e){return e}},ot=class{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,r,n){return""+n}image(e,r,n){return""+n}br(){return""}},Ee=class t{options;renderer;textRenderer;constructor(e){this.options=e||Oe,this.options.renderer=this.options.renderer||new Qe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ot}static parse(e,r){return new t(r).parse(e)}static parseInline(e,r){return new t(r).parseInline(e)}parse(e,r=!0){let n="";for(let i=0;i<e.length;i++){let a=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[a.type]){let o=a,s=this.options.extensions.renderers[o.type].call({parser:this},o);if(s!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(o.type)){n+=s||"";continue}}switch(a.type){case"space":continue;case"hr":{n+=this.renderer.hr();continue}case"heading":{let o=a;n+=this.renderer.heading(this.parseInline(o.tokens),o.depth,bo(this.parseInline(o.tokens,this.textRenderer)));continue}case"code":{let o=a;n+=this.renderer.code(o.text,o.lang,!!o.escaped);continue}case"table":{let o=a,s="",l="";for(let c=0;c<o.header.length;c++)l+=this.renderer.tablecell(this.parseInline(o.header[c].tokens),{header:!0,align:o.align[c]});s+=this.renderer.tablerow(l);let u="";for(let c=0;c<o.rows.length;c++){let f=o.rows[c];l="";for(let d=0;d<f.length;d++)l+=this.renderer.tablecell(this.parseInline(f[d].tokens),{header:!1,align:o.align[d]});u+=this.renderer.tablerow(l)}n+=this.renderer.table(s,u);continue}case"blockquote":{let o=a,s=this.parse(o.tokens);n+=this.renderer.blockquote(s);continue}case"list":{let o=a,s=o.ordered,l=o.start,u=o.loose,c="";for(let f=0;f<o.items.length;f++){let d=o.items[f],h=d.checked,p=d.task,m="";if(d.task){let v=this.renderer.checkbox(!!h);u?d.tokens.length>0&&d.tokens[0].type==="paragraph"?(d.tokens[0].text=v+" "+d.tokens[0].text,d.tokens[0].tokens&&d.tokens[0].tokens.length>0&&d.tokens[0].tokens[0].type==="text"&&(d.tokens[0].tokens[0].text=v+" "+d.tokens[0].tokens[0].text)):d.tokens.unshift({type:"text",text:v+" "}):m+=v+" "}m+=this.parse(d.tokens,u),c+=this.renderer.listitem(m,p,!!h)}n+=this.renderer.list(c,s,l);continue}case"html":{let o=a;n+=this.renderer.html(o.text,o.block);continue}case"paragraph":{let o=a;n+=this.renderer.paragraph(this.parseInline(o.tokens));continue}case"text":{let o=a,s=o.tokens?this.parseInline(o.tokens):o.text;for(;i+1<e.length&&e[i+1].type==="text";)o=e[++i],s+=`
`+(o.tokens?this.parseInline(o.tokens):o.text);n+=r?this.renderer.paragraph(s):s;continue}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return n}parseInline(e,r){r=r||this.renderer;let n="";for(let i=0;i<e.length;i++){let a=e[i];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[a.type]){let o=this.options.extensions.renderers[a.type].call({parser:this},a);if(o!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){n+=o||"";continue}}switch(a.type){case"escape":{let o=a;n+=r.text(o.text);break}case"html":{let o=a;n+=r.html(o.text);break}case"link":{let o=a;n+=r.link(o.href,o.title,this.parseInline(o.tokens,r));break}case"image":{let o=a;n+=r.image(o.href,o.title,o.text);break}case"strong":{let o=a;n+=r.strong(this.parseInline(o.tokens,r));break}case"em":{let o=a;n+=r.em(this.parseInline(o.tokens,r));break}case"codespan":{let o=a;n+=r.codespan(o.text);break}case"br":{n+=r.br();break}case"del":{let o=a;n+=r.del(this.parseInline(o.tokens,r));break}case"text":{let o=a;n+=r.text(o.text);break}default:{let o='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return n}},Ve=class{options;constructor(e){this.options=e||Oe}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}},dr=class{defaults=hr();options=this.setOptions;parse=this.#e(Me.lex,Ee.parse);parseInline=this.#e(Me.lexInline,Ee.parseInline);Parser=Ee;Renderer=Qe;TextRenderer=ot;Lexer=Me;Tokenizer=Xe;Hooks=Ve;constructor(...e){this.use(...e)}walkTokens(e,r){let n=[];for(let i of e)switch(n=n.concat(r.call(this,i)),i.type){case"table":{let a=i;for(let o of a.header)n=n.concat(this.walkTokens(o.tokens,r));for(let o of a.rows)for(let s of o)n=n.concat(this.walkTokens(s.tokens,r));break}case"list":{let a=i;n=n.concat(this.walkTokens(a.items,r));break}default:{let a=i;this.defaults.extensions?.childTokens?.[a.type]?this.defaults.extensions.childTokens[a.type].forEach(o=>{let s=a[o].flat(1/0);n=n.concat(this.walkTokens(s,r))}):a.tokens&&(n=n.concat(this.walkTokens(a.tokens,r)))}}return n}use(...e){let r=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{let i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){let o=r.renderers[a.name];o?r.renderers[a.name]=function(...s){let l=a.renderer.apply(this,s);return l===!1&&(l=o.apply(this,s)),l}:r.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=r[a.level];o?o.unshift(a.tokenizer):r[a.level]=[a.tokenizer],a.start&&(a.level==="block"?r.startBlock?r.startBlock.push(a.start):r.startBlock=[a.start]:a.level==="inline"&&(r.startInline?r.startInline.push(a.start):r.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(r.childTokens[a.name]=a.childTokens)}),i.extensions=r),n.renderer){let a=this.defaults.renderer||new Qe(this.defaults);for(let o in n.renderer){if(!(o in a))throw new Error(`renderer '${o}' does not exist`);if(o==="options")continue;let s=o,l=n.renderer[s],u=a[s];a[s]=(...c)=>{let f=l.apply(a,c);return f===!1&&(f=u.apply(a,c)),f||""}}i.renderer=a}if(n.tokenizer){let a=this.defaults.tokenizer||new Xe(this.defaults);for(let o in n.tokenizer){if(!(o in a))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let s=o,l=n.tokenizer[s],u=a[s];a[s]=(...c)=>{let f=l.apply(a,c);return f===!1&&(f=u.apply(a,c)),f}}i.tokenizer=a}if(n.hooks){let a=this.defaults.hooks||new Ve;for(let o in n.hooks){if(!(o in a))throw new Error(`hook '${o}' does not exist`);if(o==="options")continue;let s=o,l=n.hooks[s],u=a[s];Ve.passThroughHooks.has(o)?a[s]=c=>{if(this.defaults.async)return Promise.resolve(l.call(a,c)).then(d=>u.call(a,d));let f=l.call(a,c);return u.call(a,f)}:a[s]=(...c)=>{let f=l.apply(a,c);return f===!1&&(f=u.apply(a,c)),f}}i.hooks=a}if(n.walkTokens){let a=this.defaults.walkTokens,o=n.walkTokens;i.walkTokens=function(s){let l=[];return l.push(o.call(this,s)),a&&(l=l.concat(a.call(this,s))),l}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,r){return Me.lex(e,r??this.defaults)}parser(e,r){return Ee.parse(e,r??this.defaults)}#e(e,r){return(n,i)=>{let a={...i},o={...this.defaults,...a};this.defaults.async===!0&&a.async===!1&&(o.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),o.async=!0);let s=this.#t(!!o.silent,!!o.async);if(typeof n>"u"||n===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));if(o.hooks&&(o.hooks.options=o),o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(n):n).then(l=>e(l,o)).then(l=>o.hooks?o.hooks.processAllTokens(l):l).then(l=>o.walkTokens?Promise.all(this.walkTokens(l,o.walkTokens)).then(()=>l):l).then(l=>r(l,o)).then(l=>o.hooks?o.hooks.postprocess(l):l).catch(s);try{o.hooks&&(n=o.hooks.preprocess(n));let l=e(n,o);o.hooks&&(l=o.hooks.processAllTokens(l)),o.walkTokens&&this.walkTokens(l,o.walkTokens);let u=r(l,o);return o.hooks&&(u=o.hooks.postprocess(u)),u}catch(l){return s(l)}}}#t(e,r){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let i="<p>An error occurred:</p><pre>"+ie(n.message+"",!0)+"</pre>";return r?Promise.resolve(i):i}if(r)return Promise.reject(n);throw n}}},Pe=new dr;function U(t,e){return Pe.parse(t,e)}U.options=U.setOptions=function(t){return Pe.setOptions(t),U.defaults=Pe.defaults,gn(U.defaults),U};U.getDefaults=hr;U.defaults=Oe;U.use=function(...t){return Pe.use(...t),U.defaults=Pe.defaults,gn(U.defaults),U};U.walkTokens=function(t,e){return Pe.walkTokens(t,e)};U.parseInline=Pe.parseInline;U.Parser=Ee;U.parser=Ee.parse;U.Renderer=Qe;U.TextRenderer=ot;U.Lexer=Me;U.lexer=Me.lex;U.Tokenizer=Xe;U.Hooks=Ve;U.parse=U;var Ol=U.options,Nl=U.setOptions,Zl=U.use,Gl=U.walkTokens,Hl=U.parseInline;var jl=Ee.parse,ql=Me.lex;var L=We(require("vscode")),_e=class t{static scheme="mdocx-md";_onDidChangeFile=new L.EventEmitter;onDidChangeFile=this._onDidChangeFile.event;static register(e){let r=new t;return L.workspace.registerFileSystemProvider(t.scheme,r,{isCaseSensitive:!0,isReadonly:!1})}static buildUri(e,r){let n=encodeURIComponent(e.fsPath),i=r.startsWith("/")?r:"/"+r;return L.Uri.parse(`${t.scheme}://${n}${i}`)}static parseUri(e){try{if(!e.authority)return null;let r=decodeURIComponent(e.authority);if(!r)return null;let n=e.path.startsWith("/")?e.path.slice(1):e.path;return n?{mdocxUri:L.Uri.file(r),embeddedPath:n}:null}catch{return null}}watch(e){return new L.Disposable(()=>{})}async stat(e){try{let r=t.parseUri(e);if(!r)throw L.FileSystemError.FileNotFound(e);let{mdocxUri:n,embeddedPath:i}=r,a=await this.findFile(n,i);if(!a)throw L.FileSystemError.FileNotFound(e);return{type:L.FileType.File,ctime:0,mtime:Date.now(),size:a.content.byteLength}}catch(r){throw r instanceof L.FileSystemError?r:L.FileSystemError.FileNotFound(e)}}async readDirectory(e){return[]}createDirectory(e){throw L.FileSystemError.NoPermissions("Cannot create directories in MDOCX.")}async readFile(e){try{let r=t.parseUri(e);if(!r)throw L.FileSystemError.FileNotFound(e);let{mdocxUri:n,embeddedPath:i}=r,a=await this.findFile(n,i);if(!a)throw L.FileSystemError.FileNotFound(e);return a.content}catch(r){throw r instanceof L.FileSystemError?r:L.FileSystemError.FileNotFound(e)}}async writeFile(e,r,n){let i=t.parseUri(e);if(!i)throw L.FileSystemError.FileNotFound(e);let{mdocxUri:a,embeddedPath:o}=i,s=await L.workspace.fs.readFile(a),{readMdocx:l,writeMdocxAsync:u}=await Promise.resolve().then(()=>(we(),ye)),c=await l(s),f=c.markdown.files.find(h=>h.path===o);if(!f)throw L.FileSystemError.FileNotFound(e);f.content=r;let d=await u(c.markdown,c.media,{metadata:c.metadata,markdownCompression:"zip",mediaCompression:"zip"});await L.workspace.fs.writeFile(a,d),this._onDidChangeFile.fire([{type:L.FileChangeType.Changed,uri:e}])}delete(e,r){throw L.FileSystemError.NoPermissions("Cannot delete files from MDOCX via this provider.")}rename(e,r,n){throw L.FileSystemError.NoPermissions("Cannot rename files in MDOCX via this provider.")}async findFile(e,r){try{let n=await L.workspace.fs.readFile(e),{readMdocx:i}=await Promise.resolve().then(()=>(we(),ye));return(await i(n)).markdown.files.find(o=>o.path===r)}catch{return}}};var Ll="mdocx.preview",sr=class t{constructor(e){this._context=e}static register(e){let r=new t(e);return B.window.registerCustomEditorProvider(Ll,r,{webviewOptions:{retainContextWhenHidden:!0}})}async openCustomDocument(e,r,n){return{uri:e,dispose:()=>{}}}async resolveCustomEditor(e,r,n){r.webview.options={enableScripts:!0};let i,a=!1,o=async d=>{let h=await this.renderDocument(e.uri,d??i);i=h.path||d||i,await r.webview.postMessage(h)},s=r.webview.onDidReceiveMessage(async d=>{if(!(!d||typeof d.type!="string")){if(d.type==="ready"){a=!0,typeof d.selectedPath=="string"&&d.selectedPath.length>0&&(i=d.selectedPath),await o(i);return}if(d.type==="select"&&typeof d.path=="string"){i=d.path,await o(i);return}if(d.type==="copy"){let h=typeof d.path=="string"&&d.path.length>0?d.path:i,p=await this.getMarkdownText(e.uri,h);if(!p){B.window.showWarningMessage("MDOCX: No markdown content to copy.");return}await B.env.clipboard.writeText(p),B.window.showInformationMessage("MDOCX: Markdown copied to clipboard.");return}if(d.type==="edit"){let h=typeof d.path=="string"&&d.path.length>0?d.path:i;if(!h){B.window.showWarningMessage("MDOCX: No markdown file selected to edit.");return}let p=_e.buildUri(e.uri,h);await B.window.showTextDocument(p,{preview:!1});return}if(d.type==="saveMetadata"){await this.saveMetadata(e.uri,d.metadata),B.window.showInformationMessage("MDOCX: Metadata saved."),await o(i);return}if(d.type==="addMedia"){let h=await B.window.showOpenDialog({canSelectMany:!0,openLabel:"Add Media",filters:{Images:["png","jpg","jpeg","gif","webp","svg"],"All Files":["*"]}});h&&h.length>0&&(await this.addMediaFiles(e.uri,h),B.window.showInformationMessage(`MDOCX: Added ${h.length} media file(s).`),await o(i));return}if(d.type==="removeMedia"){await B.window.showWarningMessage(`Remove media "${d.id}" from MDOCX?`,{modal:!0},"Remove")==="Remove"&&(await this.removeMedia(e.uri,d.id),B.window.showInformationMessage("MDOCX: Media removed."),await o(i));return}if(d.type==="replaceMedia"){let h=await B.window.showOpenDialog({canSelectMany:!1,openLabel:"Replace Media",filters:{Images:["png","jpg","jpeg","gif","webp","svg"],"All Files":["*"]}});h&&h.length>0&&(await this.replaceMedia(e.uri,d.id,h[0]),B.window.showInformationMessage("MDOCX: Media replaced."),await o(i))}}}),l=new B.RelativePattern(Ce.dirname(e.uri.fsPath),Ce.basename(e.uri.fsPath)),u=B.workspace.createFileSystemWatcher(l),c=async()=>{await o(i)},f=[u,u.onDidChange(c),u.onDidCreate(c),u.onDidDelete(async()=>{await r.webview.postMessage({type:"render",path:"",title:"MDOCX",description:void 0,html:"",fileList:[],error:"The file was deleted from disk."})})];r.webview.html=this.getWebviewHtml(r.webview),setTimeout(async()=>{a||await o(i)},500),r.onDidDispose(()=>{s.dispose(),f.forEach(d=>d.dispose())})}async renderDocument(e,r){try{let n=await B.workspace.fs.readFile(e),{readMdocx:i,MediaResolver:a}=await Promise.resolve().then(()=>(we(),ye)),o=await i(n);o.markdown=o.markdown||{files:[]},Array.isArray(o.markdown.files)||(o.markdown.files=[]),o.media=o.media||{items:[]},Array.isArray(o.media.items)||(o.media.items=[]);let s=o.markdown.files.map(y=>y.path).sort((y,b)=>y.localeCompare(b)),l=r??o.markdown.rootPath??(typeof o.metadata?.root=="string"?o.metadata.root:void 0)??o.markdown.files[0]?.path,u=o.markdown.files.find(y=>y.path===l)??o.markdown.files[0];if(!u)return{type:"render",path:r??"",html:"",fileList:s,error:"No markdown files found in this MDOCX."};let f=new ar.TextDecoder("utf-8").decode(u.content),d=new a(o),h=this.renderMarkdownToHtml(f,{resolveMediaHref:y=>this.tryResolveMediaHrefToDataUri(d,y,u)}),p=typeof o.metadata?.title=="string"?o.metadata.title:void 0,m=typeof o.metadata?.description=="string"?o.metadata.description:void 0,v={title:p,description:m,author:typeof o.metadata?.creator=="string"?o.metadata.creator:void 0,root:o.markdown.rootPath??o.metadata?.root,tags:Array.isArray(o.metadata?.tags)?o.metadata.tags:void 0},E=(o.media.items||[]).map(y=>{let b={id:y.id,path:y.path,mimeType:y.mimeType,size:y.data?.byteLength??0};return y.mimeType?.startsWith("image/")&&y.data&&y.data.byteLength<500*1024&&(b.dataUri=`data:${y.mimeType};base64,${ln.Buffer.from(y.data).toString("base64")}`),b});return{type:"render",path:u.path,title:p,description:m,html:h,fileList:s,metadata:v,mediaItems:E}}catch(n){let i=n instanceof Error?n.message:String(n);return{type:"render",path:r??"",html:"",fileList:[],error:`Failed to read MDOCX: ${i}`}}}async getMarkdownText(e,r){try{let n=await B.workspace.fs.readFile(e),{readMdocx:i}=await Promise.resolve().then(()=>(we(),ye)),a=await i(n);a.markdown=a.markdown||{files:[]},Array.isArray(a.markdown.files)||(a.markdown.files=[]);let o=r??a.markdown.rootPath??(typeof a.metadata?.root=="string"?a.metadata.root:void 0)??a.markdown.files[0]?.path,s=a.markdown.files.find(u=>u.path===o)??a.markdown.files[0];return s?new ar.TextDecoder("utf-8").decode(s.content):void 0}catch{return}}async saveMetadata(e,r){let n=await B.workspace.fs.readFile(e),{readMdocx:i,writeMdocxAsync:a}=await Promise.resolve().then(()=>(we(),ye)),o=await i(n);o.markdown=o.markdown||{files:[]},Array.isArray(o.markdown.files)||(o.markdown.files=[]);let s=o.metadata||{};r.title!==void 0&&(s.title=r.title),r.description!==void 0&&(s.description=r.description),r.author!==void 0&&(s.creator=r.author),r.root!==void 0&&(s.root=r.root),r.tags!==void 0&&(s.tags=r.tags),r.root!==void 0&&(o.markdown.rootPath=r.root);let l=await a(o.markdown,o.media,{metadata:s,markdownCompression:"zip",mediaCompression:"zip"});await B.workspace.fs.writeFile(e,l)}async addMediaFiles(e,r){let n=await B.workspace.fs.readFile(e),{readMdocx:i,writeMdocxAsync:a}=await Promise.resolve().then(()=>(we(),ye)),o=await i(n);o.markdown=o.markdown||{files:[]},Array.isArray(o.markdown.files)||(o.markdown.files=[]),o.media=o.media||{items:[]},Array.isArray(o.media.items)||(o.media.items=[]);let s=Date.now(),l=0;for(let c of r){let f=await B.workspace.fs.readFile(c),d=Ce.basename(c.fsPath),h=Ce.extname(d).toLowerCase(),p=d.replace(/[^a-zA-Z0-9_-]/g,"_")+"_"+(s+l++),m=this.getMimeTypeFromExtension(h);o.media.items.push({id:p,path:`media/${d}`,mimeType:m,data:new Uint8Array(f)})}let u=await a(o.markdown,o.media,{metadata:o.metadata,markdownCompression:"zip",mediaCompression:"zip"});await B.workspace.fs.writeFile(e,u)}async removeMedia(e,r){let n=await B.workspace.fs.readFile(e),{readMdocx:i,writeMdocxAsync:a}=await Promise.resolve().then(()=>(we(),ye)),o=await i(n);o.markdown=o.markdown||{files:[]},Array.isArray(o.markdown.files)||(o.markdown.files=[]),o.media=o.media||{items:[]},Array.isArray(o.media.items)||(o.media.items=[]);let s=o.media.items.findIndex(u=>u.id===r);s>=0&&o.media.items.splice(s,1);let l=await a(o.markdown,o.media,{metadata:o.metadata,markdownCompression:"zip",mediaCompression:"zip"});await B.workspace.fs.writeFile(e,l)}async replaceMedia(e,r,n){let i=await B.workspace.fs.readFile(e),{readMdocx:a,writeMdocxAsync:o}=await Promise.resolve().then(()=>(we(),ye)),s=await a(i),l=s.media.items.find(c=>c.id===r);if(l){let c=await B.workspace.fs.readFile(n),f=Ce.basename(n.fsPath),d=Ce.extname(f).toLowerCase();l.data=new Uint8Array(c),l.mimeType=this.getMimeTypeFromExtension(d),l.path=`media/${f}`}let u=await o(s.markdown,s.media,{metadata:s.metadata,markdownCompression:"zip",mediaCompression:"zip"});await B.workspace.fs.writeFile(e,u)}getMimeTypeFromExtension(e){return{".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/gif",".webp":"image/webp",".svg":"image/svg+xml",".mp3":"audio/mpeg",".wav":"audio/wav",".mp4":"video/mp4",".webm":"video/webm",".pdf":"application/pdf"}[e]||"application/octet-stream"}renderMarkdownToHtml(e,r){let n=s=>{let l=(s??"").trim();return l&&(l.startsWith("#")||/^mailto:/i.test(l)||/^data:/i.test(l)||/^https?:\/\//i.test(l))?l:null},i=new U.Renderer;i.html=()=>"",i.link=(s,l,u)=>{let c=n(s);if(!c)return u;let f=l?` title="${this.escapeHtmlAttr(l)}"`:"",h=/^https?:\/\//i.test(c)?' rel="noreferrer noopener" target="_blank"':"";return`<a href="${this.escapeHtmlAttr(c)}"${f}${h}>${u}</a>`},i.image=(s,l,u)=>{let c=n(s);if(!c)return"";let f=l?` title="${this.escapeHtmlAttr(l)}"`:"",d=this.escapeHtmlAttr(u??"");return`<img src="${this.escapeHtmlAttr(c)}" alt="${d}"${f} />`};let a=s=>{if(r?.resolveMediaHref&&!(!s||typeof s.type!="string")&&(s.type==="image"||s.type==="link")&&typeof s.href=="string"){let l=r.resolveMediaHref(s.href);l&&(s.href=l)}},o=U.parse(e,{renderer:i,walkTokens:a});return typeof o=="string"?o:""}tryResolveMediaHrefToDataUri(e,r,n){let i=r.trim().replace(/^<|>$/g,"");if(!i||/^https?:\/\//i.test(i)||/^data:/i.test(i)||/^mailto:/i.test(i)||i.startsWith("#"))return;let o=(i.split("#")[0]?.split("?")[0]??i).replace(/\\/g,"/"),s=new Set([o,o.startsWith("./")?o.slice(2):o,o.startsWith("/")?o.slice(1):o]);try{s.add(decodeURI(o))}catch{}let l;for(let h of s){try{if(l=e.resolve(h,n),l)break}catch{}try{if(!l&&typeof e.getByPath=="function"&&(l=e.getByPath(h),l))break}catch{}try{let p=/^mdocx:\/\/media\/(.+)$/i.exec(h);if(!l&&p&&typeof e.getById=="function"&&(l=e.getById(p[1]),l))break}catch{}}if(!l||!l.data)return;let u=this.getMaxInlineMediaBytes();if(typeof l.data.byteLength=="number"&&l.data.byteLength>u)return;let c=this.inferMimeType(l),f=typeof l.mimeType=="string"&&l.mimeType.length>0?l.mimeType:c,d=ln.Buffer.from(l.data).toString("base64");return`data:${f};base64,${d}`}inferMimeType(e){let r=typeof e.path=="string"?e.path.toLowerCase():"";if(r.endsWith(".png"))return"image/png";if(r.endsWith(".jpg")||r.endsWith(".jpeg"))return"image/jpeg";if(r.endsWith(".gif"))return"image/gif";if(r.endsWith(".webp"))return"image/webp";if(r.endsWith(".svg"))return"image/svg+xml";let n=e.data;if(!n||n.length<12)return"application/octet-stream";if(n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71&&n[4]===13&&n[5]===10&&n[6]===26&&n[7]===10)return"image/png";if(n[0]===255&&n[1]===216)return"image/jpeg";if(n[0]===71&&n[1]===73&&n[2]===70)return"image/gif";if(n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70&&n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80)return"image/webp";try{let i=new ar.TextDecoder("utf-8").decode(n.slice(0,256));if(i.includes("<svg")||i.includes("<?xml"))return"image/svg+xml"}catch{}return"application/octet-stream"}getMaxInlineMediaBytes(){let e=B.workspace.getConfiguration("mdocx").get("maxInlineMediaBytes");return typeof e=="number"&&Number.isFinite(e)&&e>0?e:25*1024*1024}getWebviewHtml(e){let r=String(Date.now());return`<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src data: https: http:; style-src 'unsafe-inline'; script-src 'nonce-${r}';" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDOCX Preview</title>
  <style>
    :root {
      color-scheme: light dark;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: var(--vscode-font-family);
      color: var(--vscode-foreground);
      background: var(--vscode-editor-background);
    }
    header {
      position: sticky;
      top: 0;
      z-index: 2;
      padding: 10px 12px;
      border-bottom: 1px solid var(--vscode-editorGroup-border);
      background: var(--vscode-editor-background);
      display: flex;
      gap: 10px;
      align-items: center;
    }
    header .meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow: hidden;
    }
    header .meta .title {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    header .meta .desc {
      opacity: 0.8;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    select {
      min-width: 240px;
      max-width: 50vw;
    }
    button {
      border: 1px solid var(--vscode-button-border, transparent);
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      padding: 3px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-family: var(--vscode-font-family);
      font-size: 12px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    button svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
      opacity: 0.9;
    }
    button:hover {
      background: var(--vscode-button-hoverBackground);
    }
    main {
      padding: 18px 22px;
    }
    main img {
      max-width: 100%;
    }
    main pre {
      padding: 12px;
      overflow: auto;
      background: color-mix(in srgb, var(--vscode-editor-background) 85%, black);
      border: 1px solid var(--vscode-editorGroup-border);
      border-radius: 6px;
    }
    main code {
      font-family: var(--vscode-editor-font-family);
    }
    .error {
      color: var(--vscode-errorForeground);
      padding: 10px 12px;
      border: 1px solid var(--vscode-errorForeground);
      border-radius: 6px;
      margin: 12px 0;
      white-space: pre-wrap;
    }
    .panel {
      margin: 12px 0;
      border: 1px solid var(--vscode-editorGroup-border);
      border-radius: 6px;
      overflow: hidden;
    }
    .panel-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: color-mix(in srgb, var(--vscode-editor-background) 90%, black);
      cursor: pointer;
      user-select: none;
    }
    .panel-header:hover {
      background: color-mix(in srgb, var(--vscode-editor-background) 80%, black);
    }
    .panel-header .chevron {
      width: 12px;
      height: 12px;
      fill: currentColor;
      transition: transform 0.15s;
    }
    .panel-header.collapsed .chevron {
      transform: rotate(-90deg);
    }
    .panel-header h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 600;
    }
    .panel-body {
      padding: 12px;
    }
    .panel-header.collapsed + .panel-body {
      display: none;
    }
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 12px;
    }
    .form-row label {
      font-size: 12px;
      opacity: 0.8;
    }
    .form-row input, .form-row textarea {
      padding: 6px 8px;
      border: 1px solid var(--vscode-input-border, var(--vscode-editorGroup-border));
      background: var(--vscode-input-background);
      color: var(--vscode-input-foreground);
      border-radius: 4px;
      font-family: var(--vscode-font-family);
      font-size: 13px;
    }
    .form-row textarea {
      min-height: 60px;
      resize: vertical;
    }
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
    }
    .media-item {
      border: 1px solid var(--vscode-editorGroup-border);
      border-radius: 6px;
      padding: 8px;
      text-align: center;
      position: relative;
    }
    .media-item img {
      max-width: 100%;
      max-height: 80px;
      object-fit: contain;
      margin-bottom: 6px;
    }
    .media-item .placeholder {
      width: 100%;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: color-mix(in srgb, var(--vscode-editor-background) 85%, black);
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 11px;
      opacity: 0.6;
    }
    .media-item .info {
      font-size: 11px;
      word-break: break-all;
    }
    .media-item .actions {
      margin-top: 6px;
      display: flex;
      gap: 4px;
      justify-content: center;
    }
    .media-item button {
      padding: 2px 6px;
      font-size: 11px;
    }
    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <header>
    <select id="fileSelect" aria-label="MDOCX markdown file"></select>
    <button id="copyBtn" type="button" title="Copy Markdown to Clipboard" aria-label="Copy Markdown to Clipboard">
      <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
        <path d="M10 1H3.5A1.5 1.5 0 0 0 2 2.5V10h1V2.5a.5.5 0 0 1 .5-.5H10V1z"/>
        <path d="M5.5 4H12A2 2 0 0 1 14 6v6.5A2 2 0 0 1 12 14H5.5A2 2 0 0 1 3.5 12.5V6A2 2 0 0 1 5.5 4zm0 1A1 1 0 0 0 4.5 6v6.5a1 1 0 0 0 1 1H12a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H5.5z"/>
      </svg>
      Copy
    </button>
    <button id="editBtn" type="button" title="Edit Markdown" aria-label="Edit Markdown">
      <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
        <path d="M12.146.854a.5.5 0 0 1 .708 0l2.292 2.292a.5.5 0 0 1 0 .708l-9.5 9.5a.5.5 0 0 1-.168.11l-4 1.5a.5.5 0 0 1-.638-.638l1.5-4a.5.5 0 0 1 .11-.168l9.5-9.5zM11.207 2L3 10.207V10.5a.5.5 0 0 0 .5.5h.293L12 2.793 11.207 2zM2.5 12.5l-.646.647.793 2.121 2.121.793.647-.646L2.5 12.5z"/>
      </svg>
      Edit
    </button>
    <div class="meta">
      <div id="docTitle" class="title">MDOCX</div>
      <div id="docDesc" class="desc"></div>
    </div>
  </header>
  <main>
    <div id="error" class="error" style="display:none"></div>

    <!-- Metadata Panel -->
    <div class="panel">
      <div class="panel-header collapsed" id="metadataHeader">
        <svg class="chevron" viewBox="0 0 16 16"><path d="M6 12l4-4-4-4" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
        <h3>Metadata</h3>
      </div>
      <div class="panel-body" id="metadataBody">
        <div class="form-row">
          <label for="metaTitle">Title</label>
          <input type="text" id="metaTitle" placeholder="Document title" />
        </div>
        <div class="form-row">
          <label for="metaDescription">Description</label>
          <textarea id="metaDescription" placeholder="Document description"></textarea>
        </div>
        <div class="form-row">
          <label for="metaAuthor">Author</label>
          <input type="text" id="metaAuthor" placeholder="Author name" />
        </div>
        <div class="form-row">
          <label for="metaRoot">Root File</label>
          <select id="metaRoot"></select>
        </div>
        <div class="form-row">
          <label for="metaTags">Tags (comma-separated)</label>
          <input type="text" id="metaTags" placeholder="tag1, tag2, tag3" />
        </div>
        <div class="btn-row">
          <button type="button" id="saveMetadataBtn">Save Metadata</button>
        </div>
      </div>
    </div>

    <!-- Media Panel -->
    <div class="panel">
      <div class="panel-header collapsed" id="mediaHeader">
        <svg class="chevron" viewBox="0 0 16 16"><path d="M6 12l4-4-4-4" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
        <h3>Media (<span id="mediaCount">0</span>)</h3>
      </div>
      <div class="panel-body" id="mediaBody">
        <div class="btn-row" style="margin-top:0;margin-bottom:12px;">
          <button type="button" id="addMediaBtn">+ Add Media</button>
        </div>
        <div class="media-grid" id="mediaGrid"></div>
      </div>
    </div>

    <!-- Content Preview -->
    <div id="content"></div>
  </main>

  <script nonce="${r}">
    const vscode = acquireVsCodeApi();

    const state = vscode.getState() || {};

    const fileSelect = document.getElementById('fileSelect');
    const copyBtn = document.getElementById('copyBtn');
    const editBtn = document.getElementById('editBtn');
    const content = document.getElementById('content');
    const error = document.getElementById('error');
    const docTitle = document.getElementById('docTitle');
    const docDesc = document.getElementById('docDesc');

    // Metadata elements
    const metadataHeader = document.getElementById('metadataHeader');
    const metaTitle = document.getElementById('metaTitle');
    const metaDescription = document.getElementById('metaDescription');
    const metaAuthor = document.getElementById('metaAuthor');
    const metaRoot = document.getElementById('metaRoot');
    const metaTags = document.getElementById('metaTags');
    const saveMetadataBtn = document.getElementById('saveMetadataBtn');

    // Media elements
    const mediaHeader = document.getElementById('mediaHeader');
    const mediaCount = document.getElementById('mediaCount');
    const mediaGrid = document.getElementById('mediaGrid');
    const addMediaBtn = document.getElementById('addMediaBtn');

    // Panel toggle
    document.querySelectorAll('.panel-header').forEach(header => {
      header.addEventListener('click', () => {
        header.classList.toggle('collapsed');
      });
    });

    function setError(message) {
      if (!message) {
        error.style.display = 'none';
        error.textContent = '';
        return;
      }
      error.style.display = 'block';
      error.textContent = message;
    }

    function setFiles(files, currentPath) {
      const prev = fileSelect.value;
      fileSelect.innerHTML = '';
      metaRoot.innerHTML = '';
      for (const path of files || []) {
        const opt = document.createElement('option');
        opt.value = path;
        opt.textContent = path;
        fileSelect.appendChild(opt);

        const rootOpt = document.createElement('option');
        rootOpt.value = path;
        rootOpt.textContent = path;
        metaRoot.appendChild(rootOpt);
      }
      const desired = currentPath || prev || (files && files[0]) || '';
      if (desired) {
        fileSelect.value = desired;
      }
    }

    function setMetadata(metadata) {
      if (!metadata) return;
      metaTitle.value = metadata.title || '';
      metaDescription.value = metadata.description || '';
      metaAuthor.value = metadata.author || '';
      if (metadata.root) metaRoot.value = metadata.root;
      metaTags.value = Array.isArray(metadata.tags) ? metadata.tags.join(', ') : '';
    }

    function setMediaItems(items) {
      mediaCount.textContent = items ? items.length : 0;
      mediaGrid.innerHTML = '';
      if (!items || items.length === 0) {
        mediaGrid.innerHTML = '<p style="opacity:0.6;font-size:12px;">No media items</p>';
        return;
      }
      for (const item of items) {
        const div = document.createElement('div');
        div.className = 'media-item';

        if (item.dataUri) {
          const img = document.createElement('img');
          img.src = item.dataUri;
          img.alt = item.id;
          div.appendChild(img);
        } else {
          const placeholder = document.createElement('div');
          placeholder.className = 'placeholder';
          placeholder.textContent = item.mimeType || 'binary';
          div.appendChild(placeholder);
        }

        const info = document.createElement('div');
        info.className = 'info';
        info.innerHTML = '<strong>' + escapeHtml(item.id) + '</strong><br/>' +
          (item.path ? escapeHtml(item.path) + '<br/>' : '') +
          formatBytes(item.size);
        div.appendChild(info);

        const actions = document.createElement('div');
        actions.className = 'actions';

        const replaceBtn = document.createElement('button');
        replaceBtn.type = 'button';
        replaceBtn.textContent = 'Replace';
        replaceBtn.onclick = () => vscode.postMessage({ type: 'replaceMedia', id: item.id });
        actions.appendChild(replaceBtn);

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.textContent = 'Remove';
        removeBtn.style.background = 'var(--vscode-inputValidation-errorBackground, #5a1d1d)';
        removeBtn.onclick = () => vscode.postMessage({ type: 'removeMedia', id: item.id });
        actions.appendChild(removeBtn);

        div.appendChild(actions);
        mediaGrid.appendChild(div);
      }
    }

    function escapeHtml(str) {
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    function formatBytes(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    fileSelect.addEventListener('change', () => {
      setError(null);
      vscode.setState({ selectedPath: fileSelect.value });
      vscode.postMessage({ type: 'select', path: fileSelect.value });
    });

    copyBtn.addEventListener('click', () => {
      vscode.postMessage({ type: 'copy', path: fileSelect.value });
    });

    editBtn.addEventListener('click', () => {
      vscode.postMessage({ type: 'edit', path: fileSelect.value });
    });

    saveMetadataBtn.addEventListener('click', () => {
      const tagsStr = metaTags.value.trim();
      const tags = tagsStr ? tagsStr.split(',').map(t => t.trim()).filter(Boolean) : undefined;
      vscode.postMessage({
        type: 'saveMetadata',
        metadata: {
          title: metaTitle.value || undefined,
          description: metaDescription.value || undefined,
          author: metaAuthor.value || undefined,
          root: metaRoot.value || undefined,
          tags
        }
      });
    });

    addMediaBtn.addEventListener('click', () => {
      vscode.postMessage({ type: 'addMedia' });
    });

    // Ask extension to render using persisted selection (if any).
    vscode.postMessage({ type: 'ready', selectedPath: state.selectedPath });

    window.addEventListener('message', (event) => {
      const msg = event.data;
      if (!msg || msg.type !== 'render') return;

      if (msg.title) docTitle.textContent = msg.title;
      else docTitle.textContent = 'MDOCX';

      docDesc.textContent = msg.description || '';

      if (Array.isArray(msg.fileList)) {
        setFiles(msg.fileList, msg.path);
      }

      if (msg.metadata) {
        setMetadata(msg.metadata);
        // Sync metaRoot after files are populated
        if (msg.metadata.root) {
          metaRoot.value = msg.metadata.root;
        }
      }

      if (msg.mediaItems) {
        setMediaItems(msg.mediaItems);
      }

      if (msg.path) {
        vscode.setState({ selectedPath: msg.path });
      }

      if (msg.error) {
        setError(msg.error);
      } else {
        setError(null);
      }

      if (typeof msg.html === 'string') {
        content.innerHTML = msg.html;
      }
    });
  </script>
</body>
</html>`}escapeHtmlAttr(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}};var V=We(require("vscode"));var lr=class t{static scheme=_e.scheme;static triggerCharacters=["/","(","[","!",".",'"',"'"];static register(e){let r=new t;return V.languages.registerCompletionItemProvider({scheme:t.scheme,language:"markdown"},r,...t.triggerCharacters)}async provideCompletionItems(e,r,n,i){if(e.uri.scheme!==t.scheme)return;let a=_e.parseUri(e.uri);if(!a)return;let s=e.lineAt(r.line).text.substring(0,r.character);if(/!\[[^\]]*\]\([^)]*$/.test(s)||/\[[^\]]*\]\([^)]*$/.test(s)||/src=["'][^"']*$/.test(s)||/href=["'][^"']*$/.test(s)||/!\[$/.test(s)||/!\[[^\]]*$/.test(s))try{let u=await this.getMediaItems(a.mdocxUri);if(!u||u.length===0)return;let c=[];for(let f of u){if(f.path){let p=new V.CompletionItem(f.path,V.CompletionItemKind.File);p.detail=`${f.mimeType||"media"} (${this.formatBytes(f.size)})`,p.documentation=new V.MarkdownString(`**Media ID:** ${f.id}

**Path:** ${f.path}

**Type:** ${f.mimeType||"unknown"}

**Size:** ${this.formatBytes(f.size)}`),p.insertText=f.path,p.sortText="0_"+f.path,c.push(p)}let d=`mdocx://media/${f.id}`,h=new V.CompletionItem(d,V.CompletionItemKind.Reference);h.detail=`${f.mimeType||"media"} by ID`,h.documentation=new V.MarkdownString(`**Media ID:** ${f.id}

**Path:** ${f.path||"N/A"}

**Type:** ${f.mimeType||"unknown"}

**Size:** ${this.formatBytes(f.size)}`),h.insertText=d,h.sortText="1_"+f.id,c.push(h)}if(/!\[$/.test(s)){for(let f of u)if(f.mimeType?.startsWith("image/")){let d=`[${f.id}](${f.path||`mdocx://media/${f.id}`})`,h=new V.CompletionItem(`Image: ${f.id}`,V.CompletionItemKind.Snippet);h.detail="Insert complete image markdown",h.documentation=new V.MarkdownString(`Inserts: \`![${f.id}](${f.path||`mdocx://media/${f.id}`})\``),h.insertText=new V.SnippetString(`[\${1:${f.id}}](${f.path||`mdocx://media/${f.id}`})`),h.sortText="2_"+f.id,c.push(h)}}return c}catch{return}}async getMediaItems(e){try{let r=await V.workspace.fs.readFile(e),{readMdocx:n}=await Promise.resolve().then(()=>(we(),ye));return((await n(r)).media.items||[]).map(a=>({id:a.id,path:a.path,mimeType:a.mimeType,size:a.data?.byteLength??0}))}catch{return[]}}formatBytes(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(2)+" MB"}};function $l(t){t.subscriptions.push(_e.register(t)),t.subscriptions.push(sr.register(t)),t.subscriptions.push(lr.register(t))}function Rl(){}0&&(module.exports={activate,deactivate});
